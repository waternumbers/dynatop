<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Code Performance for larger simulations • dynatop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Code Performance for larger simulations">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dynatop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Performance_Evaluation.html">Code Performance for larger simulations</a>
    </li>
    <li>
      <a href="../articles/The_solution_of_Dynamic_TOPMODEL.html">The Numerical Solution of Dynamic TOPMODEL</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waternumbers/dynatop">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Code Performance for larger simulations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waternumbers/dynatop/blob/master/vignettes/Performance_Evaluation.Rmd"><code>vignettes/Performance_Evaluation.Rmd</code></a></small>
      <div class="hidden name"><code>Performance_Evaluation.Rmd</code></div>

    </div>

    
    
<p>This vignette studies the performance of the dynamic TOPMODEL code for ‘larger’ simulations. The term ‘larger’ in given some context in the following section which considers the possible scale of simulations that might be required and the impact of this on the code structure. This highlights potential performance bottlenecks. These bottlenecks are explored by simulation in the following section and based on these soem developments are proposed.</p>
<div id="scale-of-simulations" class="section level1">
<h1 class="hasAnchor">
<a href="#scale-of-simulations" class="anchor"></a>Scale of simulations</h1>
<p>The scale of a dynamic TOPMODEL simualtions is related to a number of factors given below along with the upper limits considered in the discussion</p>
<table class="table">
<caption>Factor affecting performance and limits considered</caption>
<thead><tr class="header">
<th align="left">Factor</th>
<th align="right">Value</th>
<th align="left">Comment</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">The number of time steps to be evaluated</td>
<td align="right">1e+06</td>
<td align="left">Approximatly 30 years of 15 minute data</td>
</tr>
<tr class="even">
<td align="left">The number of input series</td>
<td align="right">1e+03</td>
<td align="left">Enough to allow for some representation of spatial input</td>
</tr>
<tr class="odd">
<td align="left">The number of hillslope HRU</td>
<td align="right">5e+03</td>
<td align="left">Approximatly 10 hillsope units for each spatial input</td>
</tr>
<tr class="even">
<td align="left">The number of channel HRU</td>
<td align="right">1e+03</td>
<td align="left">Enough to output 1000km of river in 1km lengths for a hydraulic model</td>
</tr>
<tr class="odd">
<td align="left">The number of computational steps</td>
<td align="right">3e+06</td>
<td align="left">Approximatly running 30 years of 15 minute data with 3 sub steps (5 minute step)</td>
</tr>
</tbody>
</table>
<div id="memory-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#memory-usage" class="anchor"></a>Memory usage</h2>
<p>R has some interesting and at times complex memory usage patterns. A fuller overview of these can be found <a href="http://adv-r.had.co.nz/memory.html">here</a>.</p>
<p>The dynatop function holds all its values within memory (including swap if enabled). The amount of memory used for the storage of variables can be broken into different classes for which approximate values are shown below. It shows that it is likely that the memory usage is going to be dominated by handling the input and output data.</p>
<table class="table">
<caption>Approximate memory usage in MB assuming a 8 bit numeric values</caption>
<thead><tr class="header">
<th align="left">Usage</th>
<th align="right">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Storage of input data</td>
<td align="right">8e+03</td>
</tr>
<tr class="even">
<td align="left">Storage of output data</td>
<td align="right">8e+03</td>
</tr>
<tr class="odd">
<td align="left">Storage of hillslope states &amp; parameters</td>
<td align="right">8e-01</td>
</tr>
<tr class="even">
<td align="left">Storage of channel states</td>
<td align="right">3e-02</td>
</tr>
</tbody>
</table>
<p>The simpliest method to address memory usage limits is to split the input data into sequential chunks (e.g. a year at a time) then evaluate them initialising the model with the final states from the previous chunk. Then by reading the input and writing the output for each chunk individually the memory use can be constrained. The  function allows for this, returning the final state and allowing initial states to be provided. It is left to the user to script the remainder based on their specific requirements.</p>
</div>
<div id="computational-performance" class="section level2">
<h2 class="hasAnchor">
<a href="#computational-performance" class="anchor"></a>Computational performance</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## library(dynatop)</code></pre></div>
</div>
</div>
<div id="appendix" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h1>
<p>The simulations were performed on a machine with equiped with Intel Core i7 CPU 920 <span class="citation">@2.67</span> Ghz processors and 11.7 Gb of RAM. The session information is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/sessionInfo">sessionInfo</a></span>()
<span class="co">#&gt; R version 3.6.0 (2019-04-26)</span>
<span class="co">#&gt; Platform: x86_64-suse-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: openSUSE Leap 15.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /usr/lib64/R/lib/libRblas.so</span>
<span class="co">#&gt; LAPACK: /usr/lib64/R/lib/libRlapack.so</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   </span>
<span class="co">#&gt;  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_1.0.1       knitr_1.23       xml2_1.2.0       magrittr_1.5    </span>
<span class="co">#&gt;  [5] roxygen2_6.1.1   MASS_7.3-51.4    R6_2.4.0         rlang_0.3.4     </span>
<span class="co">#&gt;  [9] stringr_1.4.0    highr_0.8        tools_3.6.0      xfun_0.7        </span>
<span class="co">#&gt; [13] htmltools_0.3.6  commonmark_1.7   yaml_2.2.0       digest_0.6.19   </span>
<span class="co">#&gt; [17] assertthat_0.2.1 rprojroot_1.3-2  pkgdown_1.3.0    crayon_1.3.4    </span>
<span class="co">#&gt; [21] fs_1.3.1         memoise_1.1.0    evaluate_0.14    rmarkdown_1.13  </span>
<span class="co">#&gt; [25] stringi_1.4.3    compiler_3.6.0   desc_1.2.0       backports_1.1.4</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#scale-of-simulations">Scale of simulations</a><ul class="nav nav-pills nav-stacked">
<li><a href="#memory-usage">Memory usage</a></li>
      <li><a href="#computational-performance">Computational performance</a></li>
      </ul>
</li>
      <li><a href="#appendix">Appendix</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Peter Metcalfe, Paul Smith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
