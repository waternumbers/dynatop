<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checks of the Hillslope HRU â€¢ dynatop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Checks of the Hillslope HRU">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dynatop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Checks_of_the_Hillslope_HRU.html">Checks of the Hillslope HRU</a>
    </li>
    <li>
      <a href="../articles/Checks_of_the_Time_Delay_routing.html">Checks of the Time Delay Routing</a>
    </li>
    <li>
      <a href="../articles/Performance_Evaluation.html">Code Performance for larger simulations</a>
    </li>
    <li>
      <a href="../articles/Selected_References.html">Selected References</a>
    </li>
    <li>
      <a href="../articles/The_Model_Object.html">The Model Object</a>
    </li>
    <li>
      <a href="../articles/The_solution_of_Dynamic_TOPMODEL.html">The Numerical Solution of Dynamic TOPMODEL</a>
    </li>
    <li>
      <a href="../articles/Time_Delay_Channel_Routing.html">Time Delay Channel Routing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waternumbers/dynatop">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Checks of the Hillslope HRU</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waternumbers/dynatop/blob/master/../vignettes/Checks_of_the_Hillslope_HRU.Rmd"><code>../vignettes/Checks_of_the_Hillslope_HRU.Rmd</code></a></small>
      <div class="hidden name"><code>Checks_of_the_Hillslope_HRU.Rmd</code></div>

    </div>

    
    
<p>The purpose of this vignette is to demonstrate some simulation checks on the computation of hillslope elements. It provides both a check for the current implimentation of the code and a demonstration for those that may be developing more complex systems and want to perform their own test.</p>
<p>The basis of the simulations used in the test catchment contained within the package which is loaded with</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(<span class="dt">list=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ls">ls</a></span>())</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dynatop)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt; Loading required package: xts</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; Loading required package: zoo</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; Attaching package: 'zoo'</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt;     as.Date, as.Date.numeric</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; Registered S3 method overwritten by 'xts':</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt;   method     from</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt;   as.zoo.xts zoo</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt; Loading required package: deSolve</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"test_catchment"</span>)</a></code></pre></div>
<div id="computing-the-volume-of-water-in-the-hillslope" class="section level1">
<h1 class="hasAnchor">
<a href="#computing-the-volume-of-water-in-the-hillslope" class="anchor"></a>Computing the volume of water in the hillslope</h1>
<p>The volume of water in the hillslope can be computed from the states of the system upto an additive constant. The volume in each hillslope HRU is given by the sum of the surface excess, root zone, unsaturated zone and saturated zone storages multiplied by the surface area. However only the storage deficit of saturated zone is known. We therefore subtract this value and treat the unknown maximum saturated zone storage as an unknown additive constant. Note that this can result in apparently negatoive storages, but is adequate for the purposes of assessing changes to storage.</p>
<p>In R this is implimented by the following function whose result is in m<span class="math inline">\(^3\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">hillslope_volume &lt;-<span class="st"> </span><span class="cf">function</span>(mdl,<span class="dt">ignore_ssz=</span><span class="ot">FALSE</span>){</a>
<a class="sourceLine" id="cb2-2" title="2">  tmp &lt;-<span class="st"> </span>mdl<span class="op">$</span>states<span class="op">$</span>hillslope</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="cf">if</span>(<span class="op">!</span>ignore_ssz){</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>( tmp<span class="op">$</span>area <span class="op">*</span><span class="st"> </span>(tmp<span class="op">$</span>ex <span class="op">+</span><span class="st"> </span>tmp<span class="op">$</span>srz <span class="op">+</span><span class="st"> </span>tmp<span class="op">$</span>suz <span class="op">-</span><span class="st"> </span>tmp<span class="op">$</span>ssz) )</a>
<a class="sourceLine" id="cb2-5" title="5">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>( tmp<span class="op">$</span>area <span class="op">*</span><span class="st"> </span>(tmp<span class="op">$</span>ex <span class="op">+</span><span class="st"> </span>tmp<span class="op">$</span>srz <span class="op">+</span><span class="st"> </span>tmp<span class="op">$</span>suz) )</a>
<a class="sourceLine" id="cb2-7" title="7">  }</a>
<a class="sourceLine" id="cb2-8" title="8">}</a></code></pre></div>
</div>
<div id="initialising-the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#initialising-the-model" class="anchor"></a>Initialising the model</h1>
<p>In calling <code>dynatop</code> the states can either be provided as part of the model structure of can be initialised internally. Since the package does not export a function for initialising the states within the model structure the follwoing function is used:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">init_model &lt;-<span class="st"> </span><span class="cf">function</span>(mdl, recharge){</a>
<a class="sourceLine" id="cb3-2" title="2">  mdl<span class="op">$</span>states &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()</a>
<a class="sourceLine" id="cb3-3" title="3">  mdl<span class="op">$</span>states<span class="op">$</span>hillslope &lt;-<span class="st"> </span><span class="kw"><a href="../reference/initialise_hru.html">initialise_hillslope</a></span>(mdl,recharge)</a>
<a class="sourceLine" id="cb3-4" title="4">  mdl<span class="op">$</span>states<span class="op">$</span>channel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/initialise_hru.html">initialise_channel</a></span>(mdl)</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(mdl)</a>
<a class="sourceLine" id="cb3-6" title="6">}  </a></code></pre></div>
<p>However for testing it is useful to be able to manipulate the states manually.</p>
</div>
<div id="saturated-zone-drain-down" class="section level1">
<h1 class="hasAnchor">
<a href="#saturated-zone-drain-down" class="anchor"></a>Saturated zone drain down</h1>
<p>This check tests the performance of the saturated zone solution when there is no flow from the unsaturated zone.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co">## create a zero input and output forcing series</span></a>
<a class="sourceLine" id="cb4-2" title="2">obs &lt;-<span class="st"> </span>test_catchment<span class="op">$</span>obs</a>
<a class="sourceLine" id="cb4-3" title="3">obs<span class="op">$</span>rain[] &lt;-<span class="st"> </span>obs<span class="op">$</span>pet[] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">## initialise the model and set all stores except saturated zone to 0</span></a>
<a class="sourceLine" id="cb4-6" title="6">initial_mdl &lt;-<span class="st"> </span><span class="kw">init_model</span>(test_catchment<span class="op">$</span>model,<span class="fl">0.015</span>)</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="cf">for</span>(ii <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ex"</span>,<span class="st">"srz"</span>,<span class="st">"suz"</span>)){</a>
<a class="sourceLine" id="cb4-8" title="8">  initial_mdl<span class="op">$</span>states<span class="op">$</span>hillslope[[ii]][] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb4-9" title="9">}</a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">## simulate the model and seperate the output</span></a>
<a class="sourceLine" id="cb4-12" title="12">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">## volume balance</span></a>
<a class="sourceLine" id="cb4-15" title="15">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl)</a>
<a class="sourceLine" id="cb4-16" title="16">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb4-17" title="17">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diff">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb4-18" title="18"></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">## error as an average depth</span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(initial_vol <span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol)) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>model<span class="op">$</span>states<span class="op">$</span>hillslope<span class="op">$</span>area)</a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">#&gt; [1] 0.0001258917</span></a></code></pre></div>
</div>
<div id="saturated-and-unsaturated-zone-drain-down" class="section level1">
<h1 class="hasAnchor">
<a href="#saturated-and-unsaturated-zone-drain-down" class="anchor"></a>Saturated and unsaturated zone drain down</h1>
<p>We repeat the saturated zone drain down test with initial unsaturated zone storage but no forcing inputs.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">## create a zero input and output forcing series</span></a>
<a class="sourceLine" id="cb5-2" title="2">obs &lt;-<span class="st"> </span>test_catchment<span class="op">$</span>obs</a>
<a class="sourceLine" id="cb5-3" title="3">obs<span class="op">$</span>rain[] &lt;-<span class="st"> </span>obs<span class="op">$</span>pet[] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">## initialise the model and set all stores except saturated zone to 0</span></a>
<a class="sourceLine" id="cb5-6" title="6">initial_mdl &lt;-<span class="st"> </span><span class="kw">init_model</span>(test_catchment<span class="op">$</span>model,<span class="fl">0.015</span>)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="cf">for</span>(ii <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"ex"</span>,<span class="st">"srz"</span>)){</a>
<a class="sourceLine" id="cb5-8" title="8">  initial_mdl<span class="op">$</span>states<span class="op">$</span>hillslope[[ii]][] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb5-9" title="9">}</a>
<a class="sourceLine" id="cb5-10" title="10"></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">## simulate the model and seperate the output</span></a>
<a class="sourceLine" id="cb5-12" title="12">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-13" title="13"></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">## volume balance</span></a>
<a class="sourceLine" id="cb5-15" title="15">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl)</a>
<a class="sourceLine" id="cb5-16" title="16">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb5-17" title="17">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diff">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb5-18" title="18"></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">## error as an average depth</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(initial_vol <span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol)) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>model<span class="op">$</span>states<span class="op">$</span>hillslope<span class="op">$</span>area)</a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt; [1] 0.0001691302</span></a></code></pre></div>
</div>
<div id="surface-excess-movement" class="section level1">
<h1 class="hasAnchor">
<a href="#surface-excess-movement" class="anchor"></a>Surface excess movement</h1>
<p>This tests the solution to the redistribution of surface storage with no additional inflows</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co">## create a zero input and output forcing series</span></a>
<a class="sourceLine" id="cb6-2" title="2">obs &lt;-<span class="st"> </span>test_catchment<span class="op">$</span>obs</a>
<a class="sourceLine" id="cb6-3" title="3">obs<span class="op">$</span>rain[] &lt;-<span class="st"> </span>obs<span class="op">$</span>pet[] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">## initialise the model as 'dry' except for surface excess</span></a>
<a class="sourceLine" id="cb6-6" title="6">initial_mdl &lt;-<span class="st"> </span><span class="kw">init_model</span>(test_catchment<span class="op">$</span>model,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; Error in try({ : </span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt;   Solution for saturated zone initialisation produced negative or zero flows.</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt;  Using constant recharge across catchment</span></a>
<a class="sourceLine" id="cb6-10" title="10">initial_mdl<span class="op">$</span>states<span class="op">$</span>hillslope<span class="op">$</span>srz[] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb6-11" title="11">initial_mdl<span class="op">$</span>states<span class="op">$</span>hillslope<span class="op">$</span>ex[] &lt;-<span class="st"> </span><span class="fl">0.1</span></a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">## simulate the model and seperate the output</span></a>
<a class="sourceLine" id="cb6-14" title="14">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-15" title="15"></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">## volume balance</span></a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl,<span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-19" title="19">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model,<span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-20" title="20">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diff">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb6-21" title="21"></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co"># error as percent</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(initial_vol <span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol)) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(initial_vol)<span class="op">*</span><span class="dv">100</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co">#&gt; [1] 0.1175767</span></a></code></pre></div>
</div>
<div id="all-model-with-no-evapotranspiration-losses" class="section level1">
<h1 class="hasAnchor">
<a href="#all-model-with-no-evapotranspiration-losses" class="anchor"></a>All model with no evapotranspiration losses</h1>
<p>This tests the solution assuming there is no loss to evapotranspiration. testing beyond this requires the recording ot the losses to evapotranspiration.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co">## create a zero input and output forcing series</span></a>
<a class="sourceLine" id="cb7-2" title="2">obs &lt;-<span class="st"> </span>test_catchment<span class="op">$</span>obs</a>
<a class="sourceLine" id="cb7-3" title="3">obs<span class="op">$</span>pet[] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">## initialise the model as 'dry' except for surface excess</span></a>
<a class="sourceLine" id="cb7-6" title="6">initial_mdl &lt;-<span class="st"> </span><span class="kw">init_model</span>(test_catchment<span class="op">$</span>model,<span class="fl">0.015</span>)</a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">## simulate the model and seperate the output</span></a>
<a class="sourceLine" id="cb7-9" title="9">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">## volume balance</span></a>
<a class="sourceLine" id="cb7-12" title="12">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl)</a>
<a class="sourceLine" id="cb7-13" title="13">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb7-14" title="14">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diff">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb7-15" title="15">rain_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(obs<span class="op">$</span>rain) <span class="op">*</span><span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diff">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))<span class="op">/</span><span class="dv">3600</span>) <span class="op">*</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="st">  </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>model<span class="op">$</span>states<span class="op">$</span>hillslope<span class="op">$</span>area) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>model<span class="op">$</span>states<span class="op">$</span>channel<span class="op">$</span>area))</a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co"># error as average over catchment</span></a>
<a class="sourceLine" id="cb7-18" title="18">((initial_vol <span class="op">+</span><span class="st"> </span>rain_vol)<span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol)) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(out<span class="op">$</span>model<span class="op">$</span>states<span class="op">$</span>hillslope<span class="op">$</span>area)</a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt; [1] 0.001266055</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#computing-the-volume-of-water-in-the-hillslope">Computing the volume of water in the hillslope</a></li>
      <li><a href="#initialising-the-model">Initialising the model</a></li>
      <li><a href="#saturated-zone-drain-down">Saturated zone drain down</a></li>
      <li><a href="#saturated-and-unsaturated-zone-drain-down">Saturated and unsaturated zone drain down</a></li>
      <li><a href="#surface-excess-movement">Surface excess movement</a></li>
      <li><a href="#all-model-with-no-evapotranspiration-losses">All model with no evapotranspiration losses</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Paul Smith, Peter Metcalfe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
