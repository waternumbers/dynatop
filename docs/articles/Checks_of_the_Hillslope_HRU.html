<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checks of the Hillslope HRU â€¢ dynatop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Checks of the Hillslope HRU">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dynatop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Banding.html">Banding of HSUs</a>
    </li>
    <li>
      <a href="../articles/Checks_of_the_Hillslope_HRU.html">Checks of the Hillslope HRU</a>
    </li>
    <li>
      <a href="../articles/Checks_of_the_Time_Delay_routing.html">Checks of the Time Delay Routing</a>
    </li>
    <li>
      <a href="../articles/Selected_References.html">Selected References</a>
    </li>
    <li>
      <a href="../articles/The_Model_Object.html">The Model Object</a>
    </li>
    <li>
      <a href="../articles/The_solution_of_Dynamic_TOPMODEL.html">The Dynamic TOPMODEL Implimentation</a>
    </li>
    <li>
      <a href="../articles/Time_Delay_Channel_Routing.html">Time Delay Channel Routing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waternumbers/dynatop">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Checks of the Hillslope HRU</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waternumbers/dynatop/blob/master/../vignettes/Checks_of_the_Hillslope_HRU.Rmd"><code>../vignettes/Checks_of_the_Hillslope_HRU.Rmd</code></a></small>
      <div class="hidden name"><code>Checks_of_the_Hillslope_HRU.Rmd</code></div>

    </div>

    
    
<p>The purpose of this vignette is to demonstrate some simulation checks on the computation of hillslope elements. It provides both a check for the current implimentation of the code and a demonstration for those that may be developing more complex systems and want to perform their own test.</p>
<p>The basis of the simulations used in the test catchment contained within the package which is loaded with</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dynatop)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt; Loading required package: xts</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; Loading required package: zoo</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; Attaching package: 'zoo'</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt;     as.Date, as.Date.numeric</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; Registered S3 method overwritten by 'xts':</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt;   method     from</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt;   as.zoo.xts zoo</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt; Loading required package: Matrix</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"test_catchments"</span>)</a></code></pre></div>
<div id="computing-the-volume-of-water-in-the-hillslope" class="section level1">
<h1 class="hasAnchor">
<a href="#computing-the-volume-of-water-in-the-hillslope" class="anchor"></a>Computing the volume of water in the hillslope</h1>
<p>The volume of water in the hillslope can be computed from the states of the system upto an additive constant. The volume in each hillslope HRU is given by the sum of the surface excess, root zone, unsaturated zone and saturated zone storages multiplied by the surface area. However only the storage deficit of saturated zone is known. We therefore subtract this value and treat the unknown maximum saturated zone storage as an unknown additive constant. Note that this can result in apparently negatoive storages, but is adequate for the purposes of assessing changes to storage.</p>
<p>In R this is implimented by the following function whose result is in m<span class="math inline">\(^3\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">hillslope_volume &lt;-<span class="st"> </span><span class="cf">function</span>(mdl,<span class="dt">ignore_sz=</span><span class="ot">FALSE</span>){</a>
<a class="sourceLine" id="cb2-2" title="2">  tmp &lt;-<span class="st"> </span>mdl<span class="op">$</span>hillslope</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="cf">if</span>(<span class="op">!</span>ignore_sz){</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>( tmp<span class="op">$</span>area <span class="op">*</span><span class="st"> </span>(tmp<span class="op">$</span>s_sf <span class="op">+</span><span class="st"> </span>tmp<span class="op">$</span>s_rz <span class="op">+</span><span class="st"> </span>tmp<span class="op">$</span>s_uz <span class="op">-</span><span class="st"> </span>tmp<span class="op">$</span>s_sz) )</a>
<a class="sourceLine" id="cb2-5" title="5">  }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>( tmp<span class="op">$</span>area <span class="op">*</span><span class="st"> </span>(tmp<span class="op">$</span>s_sf <span class="op">+</span><span class="st"> </span>tmp<span class="op">$</span>s_rz <span class="op">+</span><span class="st"> </span>tmp<span class="op">$</span>s_uz) )</a>
<a class="sourceLine" id="cb2-7" title="7">  }</a>
<a class="sourceLine" id="cb2-8" title="8">}</a></code></pre></div>
</div>
<div id="initialising-the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#initialising-the-model" class="anchor"></a>Initialising the model</h1>
<p>In calling <code>dynatop</code> the states can either be provided as part of the model structure of can be initialised internally. In this vignette we make use of this to initialise the model and then set certain states manually. This is not recommended in practice. However for testing it is useful to be able to manipulate the states manually.</p>
</div>
<div id="individual-levels-of-the-hillslope-with-no-forceing" class="section level1">
<h1 class="hasAnchor">
<a href="#individual-levels-of-the-hillslope-with-no-forceing" class="anchor"></a>Individual levels of the hillslope with no forceing</h1>
<p>These tests check individual levels of the hillslope representation when there is no forcing from external variables.</p>
<p>A set of forecing data with zeros values can be created by</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">obs &lt;-<span class="st"> </span>test_catchments<span class="op">$</span>obs</a>
<a class="sourceLine" id="cb3-2" title="2">obs<span class="op">$</span>rain[] &lt;-<span class="st"> </span>obs<span class="op">$</span>pet[] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>We also initialise a test model and keep this for future reuse</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">base_model &lt;-<span class="st"> </span>test_catchments<span class="op">$</span>simple_hillslope</a>
<a class="sourceLine" id="cb4-2" title="2">base_model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/initialise.html">initialise</a></span>(base_model,<span class="fl">0.015</span>)</a></code></pre></div>
<div id="surface" class="section level2">
<h2 class="hasAnchor">
<a href="#surface" class="anchor"></a>Surface</h2>
<p>With out any forcing the surface zone should redistribute water in a conservative way.</p>
<p>Take the initialised model and set all stores to be empty except the surface store.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">initial_mdl &lt;-<span class="st"> </span>base_model</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="cf">for</span>(ii <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"s_rz"</span>,<span class="st">"s_uz"</span>)){</a>
<a class="sourceLine" id="cb5-3" title="3">  initial_mdl<span class="op">$</span>hillslope[,ii] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb5-4" title="4">}</a>
<a class="sourceLine" id="cb5-5" title="5">initial_mdl<span class="op">$</span>hillslope[,<span class="st">'s_sz'</span>] &lt;-<span class="st"> </span><span class="fl">1e10</span></a>
<a class="sourceLine" id="cb5-6" title="6">initial_mdl<span class="op">$</span>hillslope[,<span class="st">'s_sf'</span>] &lt;-<span class="st"> </span><span class="fl">0.1</span></a></code></pre></div>
<p>Set the <code>q_sfmax</code> so that no water is absorbed back into the soil and <code>l_szmax</code> so that no water drains from the saturated store</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">initial_mdl<span class="op">$</span>param[<span class="st">"qsf_max_default"</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb6-2" title="2">initial_mdl<span class="op">$</span>hillslope[,<span class="st">"l_szmax"</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>Simulate the model and compute volume balance per unit area.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-2" title="2">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl)</a>
<a class="sourceLine" id="cb7-3" title="3">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb7-4" title="4">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb7-5" title="5">(initial_vol <span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol))</a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
</div>
<div id="root-zone" class="section level2">
<h2 class="hasAnchor">
<a href="#root-zone" class="anchor"></a>Root zone</h2>
<p>With out any forcing the root zone should just hold its current water.</p>
<p>Take the initialised model and set all stores to be empty except the root zone, which has the initialisation volume and the saturated zone with is set to saturation.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">initial_mdl &lt;-<span class="st"> </span>base_model</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="cf">for</span>(ii <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"s_sf"</span>,<span class="st">"s_uz"</span>,<span class="st">"s_sz"</span>)){</a>
<a class="sourceLine" id="cb8-3" title="3">  initial_mdl<span class="op">$</span>hillslope[,ii] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb8-4" title="4">}</a></code></pre></div>
<p>Set the <code>q_sfmax</code> so that no water is absorbed back into the soil from the surface store and <code>l_szmax</code> so that no water drains from the saturated store</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">initial_mdl<span class="op">$</span>param[<span class="st">"qsf_max_default"</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb9-2" title="2">initial_mdl<span class="op">$</span>hillslope[,<span class="st">"lsz_max"</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>Simulate the model and compute volume balance per unit area.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb10-2" title="2">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl)</a>
<a class="sourceLine" id="cb10-3" title="3">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb10-4" title="4">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(initial_vol <span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol))</a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
</div>
<div id="unsaturated-zone" class="section level2">
<h2 class="hasAnchor">
<a href="#unsaturated-zone" class="anchor"></a>Unsaturated zone</h2>
<p>With no forcing the unsaturated zone should drain to the saturated zone.</p>
<p>Take the initialised model and set all stores to be empty except the unsaturated zone, which has the initialisation volume and the saturated zone with is set to a greater deficit then the unsaturated zone.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">initial_mdl &lt;-<span class="st"> </span>base_model</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="cf">for</span>(ii <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"s_sf"</span>,<span class="st">"s_rz"</span>)){</a>
<a class="sourceLine" id="cb11-3" title="3">  initial_mdl<span class="op">$</span>hillslope[,ii] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb11-4" title="4">}</a>
<a class="sourceLine" id="cb11-5" title="5">initial_mdl<span class="op">$</span>hillslope[,<span class="st">'s_uz'</span>] &lt;-<span class="st"> </span><span class="fl">0.1</span></a>
<a class="sourceLine" id="cb11-6" title="6">initial_mdl<span class="op">$</span>hillslope[,<span class="st">'s_sz'</span>] &lt;-<span class="st"> </span>initial_mdl<span class="op">$</span>hillslope[,<span class="st">'s_uz'</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<p>Set the <code>q_sfmax</code> so that no water is absorbed back into the soil from the surface store and <code>l_szmax</code> so that no water drains from the saturated store</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">initial_mdl<span class="op">$</span>param[<span class="st">"qsf_max_default"</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb12-2" title="2">initial_mdl<span class="op">$</span>hillslope[,<span class="st">"lsz_max"</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>Simulate the model and compute volume balance per unit area.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb13-2" title="2">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl)</a>
<a class="sourceLine" id="cb13-3" title="3">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb13-4" title="4">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(initial_vol <span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol))</a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt; [1] 1.113489e-05</span></a></code></pre></div>
</div>
<div id="saturated-zone-drain-down" class="section level2">
<h2 class="hasAnchor">
<a href="#saturated-zone-drain-down" class="anchor"></a>Saturated zone drain down</h2>
<p>This check tests the performance of the saturated zone solution when there is no flow from the unsaturated zone. The flow should drain to the channel.</p>
<p>Take the initialised model and set all stores to be empty except the saturated zone with is set to be full</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">initial_mdl &lt;-<span class="st"> </span>base_model</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="cf">for</span>(ii <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"s_sf"</span>,<span class="st">"s_uz"</span>,<span class="st">"s_rz"</span>,<span class="st">"s_sz"</span>)){</a>
<a class="sourceLine" id="cb14-3" title="3">  initial_mdl<span class="op">$</span>hillslope[,ii] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb14-4" title="4">}</a></code></pre></div>
<p>Set the <code>q_sfmax</code> so that no water is absorbed back into the soil from the surface store if there is saturation excess</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">initial_mdl<span class="op">$</span>param[[<span class="st">"qsf_max_default"</span>]][] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>simulate the model and compute volume balance per unit area.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-2" title="2">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl)</a>
<a class="sourceLine" id="cb16-3" title="3">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb16-4" title="4">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb16-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(initial_vol <span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol))</a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co">#&gt; [1] 1.421085e-14</span></a></code></pre></div>
</div>
</div>
<div id="all-model-with-no-evapotranspiration-losses" class="section level1">
<h1 class="hasAnchor">
<a href="#all-model-with-no-evapotranspiration-losses" class="anchor"></a>All model with no evapotranspiration losses</h1>
<p>This tests the solution assuming there is no loss to evapotranspiration. Testing beyond this requires the recording ot the losses to evapotranspiration which is not yet implimented.</p>
<p>Create a new observation series</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">obs &lt;-<span class="st"> </span>test_catchments<span class="op">$</span>obs</a>
<a class="sourceLine" id="cb17-2" title="2">obs<span class="op">$</span>pet[] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>Simualate the model and compute the mass balance</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">initial_mdl &lt;-<span class="st"> </span>base_model</a>
<a class="sourceLine" id="cb18-2" title="2">out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dynatop.html">dynatop</a></span>(initial_mdl,obs,<span class="dt">use_states=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-3" title="3">initial_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(initial_mdl)</a>
<a class="sourceLine" id="cb18-4" title="4">final_vol &lt;-<span class="st"> </span><span class="kw">hillslope_volume</span>(out<span class="op">$</span>model)</a>
<a class="sourceLine" id="cb18-5" title="5">channel_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(out<span class="op">$</span>channel_input) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="kw">.index</span>(out<span class="op">$</span>channel_input)))</a>
<a class="sourceLine" id="cb18-6" title="6">precip_vol &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(obs<span class="op">$</span>rain)<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(initial_mdl<span class="op">$</span>hillslope<span class="op">$</span>area,</a>
<a class="sourceLine" id="cb18-7" title="7">                                  initial_mdl<span class="op">$</span>channel<span class="op">$</span>area))</a>
<a class="sourceLine" id="cb18-8" title="8"><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(initial_vol <span class="op">+</span><span class="st"> </span>precip_vol<span class="op">-</span><span class="st"> </span>(final_vol <span class="op">+</span><span class="st"> </span>channel_vol))</a>
<a class="sourceLine" id="cb18-9" title="9"><span class="co">#&gt; [1] 3.72529e-09</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#computing-the-volume-of-water-in-the-hillslope">Computing the volume of water in the hillslope</a></li>
      <li><a href="#initialising-the-model">Initialising the model</a></li>
      <li>
<a href="#individual-levels-of-the-hillslope-with-no-forceing">Individual levels of the hillslope with no forceing</a><ul class="nav nav-pills nav-stacked">
<li><a href="#surface">Surface</a></li>
      <li><a href="#root-zone">Root zone</a></li>
      <li><a href="#unsaturated-zone">Unsaturated zone</a></li>
      <li><a href="#saturated-zone-drain-down">Saturated zone drain down</a></li>
      </ul>
</li>
      <li><a href="#all-model-with-no-evapotranspiration-losses">All model with no evapotranspiration losses</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul Smith, Peter Metcalfe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
