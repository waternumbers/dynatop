<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Model Object • dynatop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The Model Object">
<meta property="og:description" content="dynatop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.1004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/dynatop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/HRU.html">The HRU</a>
    </li>
    <li>
      <a href="../articles/Notes_on_the_implementation_of_Dynamic_TOPMODEL.html">Notes on the implementation of Dynamic TOPMODEL</a>
    </li>
    <li>
      <a href="../articles/The_Model_Object.html">The Model Object</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waternumbers/dynatop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The Model Object</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waternumbers/dynatop/blob/HEAD/vignettes/The_Model_Object.Rmd" class="external-link"><code>vignettes/The_Model_Object.Rmd</code></a></small>
      <div class="hidden name"><code>The_Model_Object.Rmd</code></div>

    </div>

    
    
<p>The purpose of this vignette is to document the structure of a Dynamic
TOPMODEL model ‘object’; that is the structure of the model that can be generated in
the <a href="https://waternumbers.github.io/dynatopGIS/" class="external-link">dynatopGIS</a> package and is
used in calls to the <code>dynatop</code> function in the current package. Currently
the model is stored as an R variable of the list class.</p>
<p>This should be read alongside the <a href="dynatop.html">“Getting
Started”</a> vignette which demonstrates the manipulation and use
of a model object.</p>
<p>The model structure will be documented with reference to the model in the test
catchment data supplied with the package. This can be loaded with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://waternumbers.github.io/dynatop/" class="external-link">dynatop</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Swindale"</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">Swindale</span><span class="op">$</span><span class="va">model</span></span></code></pre></div>
<p>The top level of the model contains the following elements:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hru"         "output_flux" "map"</span></span></code></pre></div>
<p>we consider each of these separately.</p>
<div class="section level2">
<h2 id="map">map<a class="anchor" aria-label="anchor" href="#map"></a>
</h2>
<p>The <code>map</code> element gives the path to the raster map of HRU locations which can
be used in the creation of a new <code>dynatop</code> object to enable plotting of
the state variables.</p>
</div>
<div class="section level2">
<h2 id="output_flux">output_flux<a class="anchor" aria-label="anchor" href="#output_flux"></a>
</h2>
<p>The <code>output_flux</code> element contains a data frame which defines the series to be output
during a simulation. This is passed to the <code>sim</code> method of the <code>dynatop</code>
object. The columns of <code>output_flux</code> are given in Table
<a href="#tab:output-flux">1</a>.</p>
<p>A single output value for each series is given for each data time step. If
multiple rows of the data frame contain the same name the values of the series are summed. If the simulation is run with substeps then the outputs are
averaged over the sub steps. Note that strictly only “q_sf”, “q_sf_in”, “q_sz”
and “q_sz_in” are fluxes, the remainder are volumes.</p>
<table class="table">
<caption>
<span id="tab:output-flux">Table 1: </span> Description of <code>output_flux</code> data frame columns</caption>
<colgroup>
<col width="21%">
<col width="21%">
<col width="21%">
<col width="35%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Class</th>
<th>Unit</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>name</td>
<td>character</td>
<td>-</td>
<td>name given to the output series</td>
</tr>
<tr class="even">
<td>id</td>
<td>integer</td>
<td>-</td>
<td>id of the HRU from which the output is to be taken</td>
</tr>
<tr class="odd">
<td>flux</td>
<td>character</td>
<td>-</td>
<td>Flux to be recorded. One of “precip”, “pet”, “aet”, “q_sf”, “q_sf_in”, “q_sz”, “q_sz_in”, “s_sf”, “s_rz”, “s_uz”, “s_sz”, “v_sf_rz”, “v_rz_uz” or “v_uz_sz”.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="hru">hru<a class="anchor" aria-label="anchor" href="#hru"></a>
</h2>
<p>The <code>hru</code> contains a list, where each list element is the description of a
single HRU. Each HRU is described by a list containing the elements outlined
in Table <a href="#tab:model-table">2</a> and described in more detail in the sections
below. In many cases the naming of the variables within the vectors relates to
the variables names in the <a href="HRU.html">HRU vignette</a> as given in
<a href="Notes_on_the_implementation_of_Dynamic_TOPMODEL.html">implementation document</a>.</p>
<table class="table">
<caption>
<span id="tab:model-table">Table 2: </span> Description of top-level model components</caption>
<colgroup>
<col width="22%">
<col width="10%">
<col width="67%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Class</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>integer</td>
<td>The unique ID of the HRU</td>
</tr>
<tr class="even">
<td>states</td>
<td>numeric</td>
<td>Named numeric vector of states</td>
</tr>
<tr class="odd">
<td>properties</td>
<td>numeric</td>
<td>Named numeric vector of properties</td>
</tr>
<tr class="even">
<td>sf</td>
<td>list</td>
<td>Description of the surface zone solution</td>
</tr>
<tr class="odd">
<td>rz</td>
<td>list</td>
<td>Description of the surface zone solution</td>
</tr>
<tr class="even">
<td>uz</td>
<td>list</td>
<td>Description of the unsaturated zone solution</td>
</tr>
<tr class="odd">
<td>sz</td>
<td>list</td>
<td>Description of the saturated solution</td>
</tr>
<tr class="even">
<td>sf_flow_direction</td>
<td>list</td>
<td>Description of the surface zone outflows to other HRUs</td>
</tr>
<tr class="odd">
<td>sz_flow_direction</td>
<td>list</td>
<td>Description of the saturated zone outflows to other HRUs</td>
</tr>
<tr class="even">
<td>initialisation</td>
<td>numeric</td>
<td>Named numeric vector of initialisation parameters</td>
</tr>
<tr class="odd">
<td>precip</td>
<td>list</td>
<td>Description of the precipitation input to the HRU</td>
</tr>
<tr class="even">
<td>pet</td>
<td>list</td>
<td>Description of the PET input to the HRU</td>
</tr>
<tr class="odd">
<td>class</td>
<td>list</td>
<td>Classification information from dynatopGIS</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="states">states<a class="anchor" aria-label="anchor" href="#states"></a>
</h3>
<p>A numeric vector of states, see Table @ref{tbl:states}, such as</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="va">hru</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">states</span></span>
<span><span class="co">#&gt; s_sf s_rz s_uz s_sz </span></span>
<span><span class="co">#&gt;   NA   NA   NA   NA</span></span></code></pre></div>
<table class="table">
<caption>
<span id="tab:states">Table 3: </span> Description of numeric state vector</caption>
<colgroup>
<col width="8%">
<col width="13%">
<col width="8%">
<col width="69%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Class</th>
<th>Unit</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>s_sf</td>
<td>numeric</td>
<td>m</td>
<td>Surface Zone storage volume per unit area</td>
</tr>
<tr class="even">
<td>s_rz</td>
<td>numeric</td>
<td>m</td>
<td>Root Zone storage volume per unit area</td>
</tr>
<tr class="odd">
<td>s_uz</td>
<td>numeric</td>
<td>m</td>
<td>Unsaturated Zone storage volume per unit area</td>
</tr>
<tr class="even">
<td>s_sz</td>
<td>numeric</td>
<td>m</td>
<td>Saturated Zone storage deficit per unit area</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="properties">properties<a class="anchor" aria-label="anchor" href="#properties"></a>
</h3>
<p>A numeric vector of properties, see Table @ref{tbl:prop} such as</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="va">hru</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">properties</span></span>
<span><span class="co">#&gt;         area        width           Dx     gradient </span></span>
<span><span class="co">#&gt; 1.120000e+04 2.000000e+00 1.638000e+03 1.446232e-02</span></span></code></pre></div>
<table class="table">
<caption>
<span id="tab:prop">Table 4: </span> Description of numeric state vector</caption>
<thead><tr class="header">
<th>Name</th>
<th>Class</th>
<th>Unit</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>area</td>
<td>numeric</td>
<td>m<span class="math inline">\(^2\)</span>
</td>
<td>Surface area of the HRU</td>
</tr>
<tr class="even">
<td>width</td>
<td>numeric</td>
<td>m</td>
<td>Width of the HRU</td>
</tr>
<tr class="odd">
<td>Dx</td>
<td>numeric</td>
<td>m</td>
<td>Effective length of the HRU</td>
</tr>
<tr class="even">
<td>gradient</td>
<td>numeric</td>
<td>-</td>
<td>Average gradient</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="sf-rz-uz-sz">sf, rz, uz,&amp; sz<a class="anchor" aria-label="anchor" href="#sf-rz-uz-sz"></a>
</h3>
<p>The list variables describe the surface (sf), root zone (rz), unsaturated zone
(uz) ans saturated zone (sz) representations. Each list contains a character
vector <code>type</code> giving the type of representation and <code>parameters</code> a numeric
vector of names parameters. For example</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="va">hru</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sz</span></span>
<span><span class="co">#&gt; $type</span></span>
<span><span class="co">#&gt; [1] "exp"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $parameters</span></span>
<span><span class="co">#&gt;   t_0     m </span></span>
<span><span class="co">#&gt; 0.135 0.040</span></span></code></pre></div>
<p>The description of the types and parameters are given in the <a href="HRU.html">HRU
vignette</a></p>
</div>
<div class="section level3">
<h3 id="sf_flow_direction-sz_flow_direction">sf_flow_direction &amp; sz_flow_direction<a class="anchor" aria-label="anchor" href="#sf_flow_direction-sz_flow_direction"></a>
</h3>
<p>Each of these lists contains two vectors as specified in Table
@ref{tbl:flow}. In the special case that no outflow goes to another HRU, such
as at the outlet of the catchment, the description of the flow direction takes
the following form:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="va">hru</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sf_flow_direction</span></span>
<span><span class="co">#&gt; $id</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fraction</span></span>
<span><span class="co">#&gt; numeric(0)</span></span></code></pre></div>
<table class="table">
<caption>
<span id="tab:flow">Table 5: </span> Description of flow direction list variables</caption>
<colgroup>
<col width="5%">
<col width="7%">
<col width="5%">
<col width="82%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Class</th>
<th>Unit</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>integer</td>
<td>-</td>
<td>Vector of id values for the HRUs to which the flow is going. Must be lower then the current id</td>
</tr>
<tr class="even">
<td>frc</td>
<td>numeric</td>
<td>0-1</td>
<td>Fraction of the flow which goes from the corresponding id. Must sum to 1</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="initialisation">initialisation<a class="anchor" aria-label="anchor" href="#initialisation"></a>
</h3>
<p>The named numeric vector contains the values to use in the initialisation of
the HRU as given in Table @ref{tbl:init} and shown below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="va">hru</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">initialisation</span></span>
<span><span class="co">#&gt;    s_rz_0 r_uz_sz_0 </span></span>
<span><span class="co">#&gt;   7.5e-01   1.0e-07</span></span></code></pre></div>
<div class="line-block">Name | Class | Unit | Description |<br>
s_rz0 | numeric | 0-1 | Initial root zone depth expressed as fraction of maximum depth (parameter) |<br>
r_uz_sz0 | numeric | m/s | Initial recharge to the saturated zone per unit area (parameter) |</div>
<p>Table: (#tab:init) Description of initialisation values</p>
</div>
<div class="section level3">
<h3 id="precip-pet">precip &amp; pet<a class="anchor" aria-label="anchor" href="#precip-pet"></a>
</h3>
<p>These list contain the description of the precipitation (precip) and PET
(pet) inputs used by the HRU. Each list takes the form of two vectors as given
in Table @ref{tbl:input} and shown below. From this the average input value
is calculated.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="va">hru</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">precip</span></span>
<span><span class="co">#&gt; $name</span></span>
<span><span class="co">#&gt; [1] "precip"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fraction</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<div class="line-block">Name | Class | Unit | Description |<br>
name | character | - | Character vector containing the names of the input series to use. |<br>
frc | numeric | 0-1 | The fraction of the HRU area for which the input series is valid. Must sum to 1. |</div>
<p>Table: (#tab:input) Description of precip and pet lists</p>
</div>
<div class="section level3">
<h3 id="class">class<a class="anchor" aria-label="anchor" href="#class"></a>
</h3>
<p>Class is a list variable. while not used in the simulation code it can be used
to store information that might be of use in, for example, determining which
parameter values to apply to the HRU (see the <a href="dynatop.html">“Getting Started”</a> vignette for
an example).</p>
<p>Currently if the model is constructed using
<a href="https://waternumbers.github.io/dynatopGIS/" class="external-link">dynatopGIS</a> <code>class</code> is populated
based on the classification and channel data used in the model build process,
but the format of this is subject to change.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul Smith, Peter Metcalfe.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
