<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Hillslope HRU • dynatop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The Hillslope HRU">
<meta property="og:description" content="dynatop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9102</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dynatop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Channel_HRU.html">Channel HRU</a>
    </li>
    <li>
      <a href="../articles/Hillslope_HRU.html">The Hillslope HRU</a>
    </li>
    <li>
      <a href="../articles/Notes_on_the_implementation_of_Dynamic_TOPMODEL.html">Notes on the implementation of Dynamic TOPMODEL</a>
    </li>
    <li>
      <a href="../articles/Selected_References.html">Selected References</a>
    </li>
    <li>
      <a href="../articles/The_Model_Object.html">The Model Object</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waternumbers/dynatop/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Hillslope_HRU_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The Hillslope HRU</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waternumbers/dynatop/blob/master/vignettes/Hillslope_HRU.Rmd"><code>vignettes/Hillslope_HRU.Rmd</code></a></small>
      <div class="hidden name"><code>Hillslope_HRU.Rmd</code></div>

    </div>

    
    
<div id="conceptual-model" class="section level1">
<h1 class="hasAnchor">
<a href="#conceptual-model" class="anchor"></a>Conceptual model</h1>
<p>One of the underlying principles of dynamic TOPMODEL is that the landscape can
be broken up into hydrologically similar regions, or Hydrological Response
Units (HRUs), where all the area within a HRU behaves in a hydrologically
similar fashion. Further discussion and the connection of HRUs is outlined <a href="Notes_on_the_implementation_of_Dynamic_TOPMODEL.html">elsewhere</a>.</p>
<p>This document outlines the conceptual structure and computational
implementation of the hillslope HRU. The hillslope HRU is a representation of
an area of hill slope with, for example, similar topographic, soil and upslope area
characteristics.</p>
<p>The hillslope HRU is considered to be a area of hill slope with outflow
occurring across a specified width of it boundary.
It is formed of four zones representing the surface water, which
passes water between HRUs and drains to the root zone. The root zone characterises
the interactions between evapotranspiration and precipitation and when full spills to
the unsaturated zone. This drains to the saturated zone which also interacts
with other HRUs. The behaviour of the saturated zone is modelled using a kinematic wave
approximation.</p>
<p><em>TODO: Add figure from training course - add figure of conceptual dimensions</em></p>
<p>In the following section the governing equations of the hillslope HRU are
given in a finite volume form. Approximating equations for the solution of the
governing equations are then derived with associated implicit and semi-implicit numerical
schemes. These are valid for a wide range of transmissivity profiles,
includign those present in the code and presented in the third sections of the
vignette.</p>
<p>Two appendices provide supporting information justifying the numerical schemes
and an alternative derivation of the governing equations based on the
infinitesimal vertical slab used in the original derivation of Dynamic TOPMODEL.</p>
</div>
<div id="notation" class="section level1">
<h1 class="hasAnchor">
<a href="#notation" class="anchor"></a>Notation</h1>
<p>Table <a href="#tab:hs-x-notation">1</a> outlines the notation used for describing an
infinitesimal slab across the hillslope HRU.</p>
<p>The following conventions are used:</p>
<ul>
<li><p>All properties such as slope angles and time constants are considered
uniform along the hillslope.</p></li>
<li><p>Precipitation and Potential Evapotranspiration occur at spatially uniform
rates.</p></li>
<li><p>All fluxes <span class="math inline">\(r_{\star \rightarrow \star}\)</span> are considered to be positive when
travelling in the direction of the arrow, but can, in some cases be negative.</p></li>
<li><p>All fluxes <span class="math inline">\(l_{\star}\)</span> and <span class="math inline">\(q_{\star}\)</span> are considered to be positive flows travelling downslope.</p></li>
<li><p>The superscripts <span class="math inline">\(^+\)</span> and <span class="math inline">\(^-\)</span> are used to denote variables for the outflow
and inflow to the hillslope.</p></li>
<li><p><span class="math inline">\(\left.y\right\rvert_t\)</span> indicates the value of the
variable <span class="math inline">\(y\)</span> at time <span class="math inline">\(t\)</span></p></li>
<li><p>Spatial averages are denoted with a <span class="math inline">\(\bar{}\)</span> so for example integrating
over the length of the hillslope we find</p></li>
</ul>
<p><span class="math display">\[\begin{equation}
\int wy dx = A\bar{y}
\end{equation}\]</span></p>
<ul>
<li>Average values over a time step are denoted with a <span class="math inline">\(\hat{}\)</span>. If the
temporal average is of a spatial average the <span class="math inline">\(\bar{}\)</span> is dropped. For
example the temporal average of the spatial average <span class="math inline">\(\bar{y}\)</span> over a time step is <span class="math inline">\(\hat{y}\)</span>.</li>
</ul>
<table class="table">
<caption>
<span id="tab:hs-x-notation">Table 1: </span> Outline of notation for describing a cross
section of the hillslope HRU</caption>
<colgroup>
<col width="20%">
<col width="20%">
<col width="40%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Quantity type</th>
<th>Symbol</th>
<th>Description</th>
<th>unit</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Storage</td>
<td><span class="math inline">\(s_{sf}\)</span></td>
<td>Surface excess storage per unit width</td>
<td>m</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(s_{rz}\)</span></td>
<td>Root zone storage per unit width</td>
<td>m</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(s_{uz}\)</span></td>
<td>Unsaturated zone storage per unit width</td>
<td>m</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(s_{sz}\)</span></td>
<td>Saturated zone storage deficit per unit width</td>
<td>m</td>
</tr>
<tr class="odd">
<td>Vertical fluxes</td>
<td><span class="math inline">\(r_{sf \rightarrow rz}\)</span></td>
<td>Flow from the surface excess store to the root zone per unit width</td>
<td>m/s</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(r_{rz \rightarrow uz}\)</span></td>
<td>Flow from the root zone to the unsaturated zone per unit width</td>
<td>m/s</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(r_{uz \rightarrow sz}\)</span></td>
<td>Flow from unsaturated to saturated zone per unit width</td>
<td>m/s</td>
</tr>
<tr class="even">
<td>Lateral fluxes</td>
<td><span class="math inline">\(l_{sf}\)</span></td>
<td>Lateral flow in the surface zone per unit outflow width</td>
<td>m<span class="math inline">\(^2\)</span>/s</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(l_{sz}\)</span></td>
<td>Lateral flow in the saturated zone per unit outflow width</td>
<td>m<span class="math inline">\(^2\)</span>/s</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(q_{sf}\)</span></td>
<td>Lateral flow in the hillslope surface zone</td>
<td>m<span class="math inline">\(^3\)</span>/s</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(q_{sz}\)</span></td>
<td>Lateral inflow to the hillslope surface zone</td>
<td>m<span class="math inline">\(^3\)</span>/s</td>
</tr>
<tr class="even">
<td>Vertical fluxes to the HRU</td>
<td><span class="math inline">\(p\)</span></td>
<td>Precipitation rate</td>
<td>m/s</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(e_p\)</span></td>
<td>Potential Evapotranspiration rate</td>
<td>m/s</td>
</tr>
<tr class="even">
<td>Other HRU properties</td>
<td><span class="math inline">\(A\)</span></td>
<td>Plan area</td>
<td>m<span class="math inline">\(^3\)</span>
</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(w\)</span></td>
<td>Width of a hill slope cross section</td>
<td>m</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(\Delta x\)</span></td>
<td>Effective length of the hillslope HRU (Area divided by outflow width)</td>
<td>m</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(k_{sf}\)</span></td>
<td>Maximum flow rate from surface excess to root zone per unit width</td>
<td>m/s</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(c_{sf}\)</span></td>
<td>Surface excess storage celerity</td>
<td>m/s</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(s_{rzmax}\)</span></td>
<td>Maximum root zone storage depth</td>
<td>m</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(T_d\)</span></td>
<td>Unsaturated zone time constant per m of saturated storage deficit.</td>
<td>s/m</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(\Theta_{sz}\)</span></td>
<td>Further properties and parameters for the solution of the saturated zone</td>
<td>:-:</td>
</tr>
</tbody>
</table>
</div>
<div id="finite-volume-formulation" class="section level1">
<h1 class="hasAnchor">
<a href="#finite-volume-formulation" class="anchor"></a>Finite Volume Formulation</h1>
<p>In this section a finite volume formulation of the Dynamic TOPMODEL equations
is derived.</p>
<div id="surface-zone" class="section level2">
<h2 class="hasAnchor">
<a href="#surface-zone" class="anchor"></a>Surface zone</h2>
<p>The storage in the surface zone satisfies <span class="math inline">\(s_{sf} \geq 0\)</span>.
Surface storage is increased by lateral downslope flow from upslope HRUs.
Water flows to the root zone at a constant rate <span class="math inline">\(k_{sf}\)</span>, unless limited by
the available storage at the surface or the ability of the root zone to
receive water (for example if the saturation storage deficit is 0 and the root zone storage is full).</p>
<p>In cases where lateral flows in the saturated zone produce
saturation storage deficits water may be returned from the root
zone to the surface giving negative values of <span class="math inline">\(r_{sf \rightarrow rz}\)</span>.</p>
<p>The governing ODE for a cross section of the hillslope can be written as
<span class="math display">\[\begin{equation}
\frac{dws_{sf}}{dt} = - \frac{dq_{sf}}{dx} - wr_{sf \rightarrow rz}
\end{equation}\]</span>
where <span class="math inline">\(r_{sf \rightarrow rz} \leq k_{sf}\)</span>.</p>
<p>Integration over the hillslope length and substituting in the spatial averages gives
<span class="math display">\[\begin{equation}
A\frac{d \bar{s}_{sf}}{dt} = q_{sf}^{-} - q_{sf}^{+} - A\bar{r}_{sf \rightarrow rz}
\end{equation}\]</span></p>
<p>Since <span class="math inline">\(\Delta x = A/w^{+}\)</span> and <span class="math inline">\(l_{sf}^{-} = q_{sf}^{-}/w^{+}\)</span> re arranging gives
<span class="math display">\[\begin{equation}
\frac{d \bar{s}_{sf}}{dt} = \frac{1}{\Delta x}\left(l_{sf}^{-} - l_{sf}^{+}\right) - \bar{r}_{sf \rightarrow rz}
\end{equation}\]</span>
This equation represents the evolution in time of <span class="math inline">\(\bar{s}_{sf}\)</span> expressed in
terms of the unit width fluxes and an effective length <span class="math inline">\(A/w^+\)</span></p>
<p>To complete the formulation assume that <span class="math inline">\(l_{sf}^{+} = c_{sf}\bar{s}_{sf}\)</span>
which gives
<span class="math display">\[\begin{equation}
\frac{d \bar{s}_{sf}}{dt} = \frac{1}{\Delta x}\left(l_{sf}^{-} - c_{sf}\bar{s}_{sf}\right) - \bar{r}_{sf \rightarrow rz}
\end{equation}\]</span></p>
</div>
<div id="root-zone" class="section level2">
<h2 class="hasAnchor">
<a href="#root-zone" class="anchor"></a>Root zone</h2>
<p>The root zone gains water from precipitation and the surface zone. It loses water through
evaporation and to the unsaturated zone. Since
all the veritcal fluxes are spatially uniform the evolution can be evaluated
in terms of the spatial averages. The root zone storage satifies</p>
<p><span class="math display">\[\begin{equation} 0 \leq \bar{s}_{rz} \leq s_{rzmax} \end{equation}\]</span></p>
<p>with the governing ODE
<span class="math display">\[\begin{equation}
\frac{d\bar{s}_{rz}}{dt} = p - \frac{e_p}{s_{rzmax}} \bar{s}_{rz} +
\bar{r}_{sf\rightarrow rz} - \bar{r}_{rz \rightarrow uz}
\end{equation}\]</span></p>
<p>Fluxes from the surface and to the unsaturated zone are
controlled by the level of root zone storage along with the state of the unsaturated
and saturated zones.</p>
<p>For <span class="math inline">\(\bar{s}_{rz} \leq s_{rzmax}\)</span> then <span class="math inline">\(\bar{r}_{rz \rightarrow uz} \leq 0\)</span>. Negative
values of <span class="math inline">\(\bar{r}_{rz \rightarrow uz}\)</span> may occur only when water is returned from the
unsaturated zone due to saturation caused by lateral inflow to the saturated zone.</p>
<p>When <span class="math inline">\(\bar{s}_{rz} = s_{rzmax}\)</span> then
<span class="math display">\[\begin{equation}
p - e_p + \bar{r}_{sf\rightarrow rz} - \bar{r}_{rz \rightarrow uz} \leq 0
\end{equation}\]</span>
In this case <span class="math inline">\(\bar{r}_{rz \rightarrow uz}\)</span> may be positive if
<span class="math display">\[\begin{equation}
p - e_p + \bar{r}_{sf\rightarrow rz} &gt; 0
\end{equation}\]</span>
so long as the unsaturated zone can receive the water. If <span class="math inline">\(\bar{r}_{rz \rightarrow uz}\)</span> is ‘throttled’ by the rate at which the unsaturated zone can
receive water, then <span class="math inline">\(\bar{r}_{sf\rightarrow rz}\)</span> is adjusted (potentially becoming
negative) to ensure the equality is met.</p>
</div>
<div id="unsaturated-zone" class="section level2">
<h2 class="hasAnchor">
<a href="#unsaturated-zone" class="anchor"></a>Unsaturated Zone</h2>
<p>The unsaturated zone acts as a non-linear tank subject to the constraint
<span class="math display">\[\begin{equation} 0 \leq \bar{s}_{uz} \leq \bar{s}_{sz} \end{equation}\]</span></p>
<p>The governing ODE is written as
<span class="math display">\[\begin{equation}
\frac{d\bar{s}_{uz}}{dt} = \bar{r}_{rz \rightarrow uz} - \bar{r}_{uz \rightarrow sz}
\end{equation}\]</span></p>
<p>If water is able to pass freely to the saturated zone, then it flows at the rate
<span class="math inline">\(\frac{\bar{s}_{uz}}{T_d \bar{s}_{sz}}\)</span>. If <span class="math inline">\(\bar{s}_{sz}=\bar{s}_{uz}=0\)</span> this is interpreted to mean
that the flow rate is <span class="math inline">\(\frac{1}{T_d}\)</span>.
In this situation where <span class="math inline">\(\bar{s}_{sz}=\bar{s}_{uz}\)</span> the subsurface below
the root zone can be considered saturated, as in there is no further available
storage for water, but separated into parts: an upper part with vertical
flow and a lower part with lateral flux.</p>
<p>It is possible that <span class="math inline">\(\bar{r}_{uz \rightarrow sz}\)</span> is
constrained by the ability of the saturated zone to receive water. If
this is the case <span class="math inline">\(\bar{r}_{uz \rightarrow sz}\)</span> occurs at the maximum
possible rate and <span class="math inline">\(\bar{r}_{rz \rightarrow uz}\)</span> is limited to ensure that
<span class="math inline">\(\bar{s}_{uz} \leq \bar{s}_{sz}\)</span>.</p>
</div>
<div id="saturated-zone" class="section level2">
<h2 class="hasAnchor">
<a href="#saturated-zone" class="anchor"></a>Saturated Zone</h2>
<p>For a HRU the alteration of the storage in the saturated zone is
given by teh kinematic equation
<span class="math display">\[\begin{equation}
\frac{dw\left(D-s_{sz}\right)}{dt} = -\frac{dq_{sz}}{dx} + wr_{uz \rightarrow sz}
\end{equation}\]</span></p>
<p>Integration over the length of the hillslope and substitution of the
spatial averaged values gives
<span class="math display">\[\begin{equation}
-A\frac{d\bar{s}_{sz}}{dt} = q_{sz}^{-} - q_{sz}^{+}  + A\bar{r}_{uz \rightarrow sz}
\end{equation}\]</span></p>
<p>Rearranging this gives
<span class="math display">\[\begin{equation}
\frac{d\bar{s}_{sz}}{dt} = \frac{1}{\Delta x}\left(\frac{l_{sz}^{+} - l_{sz}^{-}\right) - \bar{r}_{uz \rightarrow sz}
\end{equation}\]</span></p>
<p>The Kinematic approximation then depends upon the specification of a relationship
between <span class="math inline">\(\bar{s}_{sz}\)</span> and <span class="math inline">\(l_{sz}^{+}\)</span>. This usually termed the transmissivity
profile however the use of the average, rather than cross sectional saturated
storage deficit means this term is used only loosely. More generally the
relationship is taken
to be a one-to-one, continuously differentiable function
<span class="math inline">\(g: \mathcal{R^{+}}\rightarrow \mathcal{R}^{+}\)</span> which returns the lateral flow on
a unit width such that <span class="math inline">\(l_{sz}^{+} = g\left(\bar{s}_{sz},\Theta_{sz}\right)  \geq 0\)</span> which satisfies
<span class="math display">\[\begin{equation}
-\frac{dl_{sz}^{+}}{d\bar{s}_{sz}} = -\frac{d}{d\bar{s}_{sz}}g\left(\bar{s}_{sz},\Theta_{sz}\right) \geq 0
\end{equation}\]</span>
and
<span class="math display">\[\begin{equation}
g\left(\bar{s}_{sz},\Theta_{sz}\right) \rightarrow 0 \quad \mathrm{as} \quad
 \bar{s}_{sz}\rightarrow \infty
\end{equation}\]</span>
The first condition ensures a non negative celerity (wave speed) which is in
keeping with the conceptualisation of the model. The first condition also implies
that <span class="math inline">\(l_{sz}^{+}\)</span> decreases with increasing <span class="math inline">\(\bar{s}_{sz}\)</span>. This combined with
the second condition ensures that the model respresents a state where no
lateral inflow is generated.</p>
<p>Using the relationship between <span class="math inline">\(l_{sz}^{+}\)</span> and <span class="math inline">\(\bar{s}_{sz}\)</span> gives
<span class="math display">\[\begin{equation}
\frac{d\bar{s}_{sz}}{dt} = \frac{1}{\Delta x}\left(g\left(\bar{s}_{sz},\Theta_{sz}\right) - l_{sz}^{-}\right) - \bar{r}_{uz \rightarrow sz}
\end{equation}\]</span></p>
</div>
</div>
<div id="approximating-equations" class="section level1">
<h1 class="hasAnchor">
<a href="#approximating-equations" class="anchor"></a>Approximating Equations</h1>
<p>No analytical solution yet exists for simultaneous integration of the system of
ODEs outlined above. In the following an implicit scheme, where fluxes
between stores are considered constant over the time step and gradients are
evaluated at the final state, is presented.</p>
<p>The basis of the solution is that a gravity driven system will maximise
the downward flow of water within each timestep of size <span class="math inline">\(\Delta t\)</span>.</p>
<p>Recalling that the temporal and spatial average vertical fluxes are denoted with
a <span class="math inline">\(\hat{}\)</span> the implicit approximations are stated in teh following sections using the unknown vertical fluxes
<span class="math inline">\(\hat{r}_{\star \rightarrow \star}\)</span> which are then determined by maximising the
downward flux.</p>
<div id="surface-excess" class="section level2">
<h2 class="hasAnchor">
<a href="#surface-excess" class="anchor"></a>Surface excess</h2>
<p>The implicit scheme gives</p>
<p><span class="math display">\[\begin{equation}
\left. \bar{s}_{sf}  \right\rvert_{\Delta t}
=
\left. \bar{s}_{sf} \right\rvert_{0}
+ \frac{\Delta t}{\Delta x} \left(
\hat{l}_{sf}^{-} - c_{sf} \left. \bar{s}_{sf}  \right\rvert_{\Delta t}
\right) 
- \Delta t \hat{r}_{sf \rightarrow rz}
\end{equation}\]</span></p>
<p>or</p>
<p><span class="math display">\[\begin{equation}
\left. \bar{s}_{sf}  \right\rvert_{\Delta t}
= \left(1 + \frac{c_{sf}\Delta t}{\Delta x}\right)^{-1}
\left( \left. \bar{s}_{sf} \right\rvert_{0}
+  \frac{\Delta t}{\Delta x} \hat{l}_{sf}^{-} - 
\Delta t \hat{r}_{sf \rightarrow rz}
\right)
\end{equation}\]</span></p>
<p>To ensure that the surface storage does not become negative
<span class="math display">\[\begin{equation}
\hat{r}_{sf \rightarrow rz} \leq \min\left( k_{sf},
\left. \frac{1}{\Delta t}\left(\bar{s}_{sf} \right\rvert_{0} + \frac{\Delta
t}{\Delta x} \hat{l}_{sf}^{-}
\right)\right)
\end{equation}\]</span></p>
<p>The surface outflow over the time step is evaluated as
<span class="math display">\[\begin{equation}
\hat{q}_{sf}^{+} = w^{+}c_{sf} \left. \bar{s}_{sf}  \right\rvert_{\Delta t}
\end{equation}\]</span></p>
</div>
<div id="root-zone-1" class="section level2">
<h2 class="hasAnchor">
<a href="#root-zone-1" class="anchor"></a>Root Zone</h2>
<p>The implicit formulation for the root zone gives
<span class="math display">\[\begin{equation}
\left. \bar{s}_{rz} \right.\rvert_{\Delta t} = 
\left( 1 + \frac{e_{p}\Delta t}{s_{rzmax}} \right)^{-1}
\left(
\left. \bar{s}_{rz} \right.\rvert_{0}
+ \Delta t \left(
p + \hat{r}_{sf \rightarrow rz} - \hat{r}_{rz \rightarrow uz} \right)
\right)
\end{equation}\]</span></p>
<p>Since flow to the unsaturated zone occur only to keep
<span class="math inline">\(\bar{s}_{rz} \leq s_{rzmax}\)</span> then
<span class="math display">\[\begin{equation}
\hat{r}_{rz \rightarrow uz} \leq \max\left(0,
\frac{1}{\Delta t}\left(
\left. \bar{s}_{rz} \right.\rvert_{0}
+ \Delta t \left(
p + \hat{r}_{sf \rightarrow rz} - e_{p} \right)
- s_{rzmax}
\right)\right)
\end{equation}\]</span></p>
</div>
<div id="unsaturated-zone-1" class="section level2">
<h2 class="hasAnchor">
<a href="#unsaturated-zone-1" class="anchor"></a>Unsaturated Zone</h2>
<p>The expression for the unsaturated zone is given in terms of
<span class="math inline">\(\left. \bar{s}_{uz} \right.\rvert_{\Delta t}\)</span> and
<span class="math inline">\(\left. \bar{s}_{sz} \right.\rvert_{\Delta t}\)</span> as</p>
<p><span class="math display">\[\begin{equation}
\left. \bar{s}_{uz} \right.\rvert_{\Delta t} = 
\frac{T_{d}\left. \bar{s}_{sz} \right.\rvert_{\Delta t}}{
T_{d}\left. \bar{s}_{sz} \right.\rvert_{\Delta t} + \Delta t}
\left( \left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \hat{r}_{rz
\rightarrow uz}\right)
\end{equation}\]</span></p>
<p>Since <span class="math inline">\(\left. \bar{s}_{uz} \right.\rvert_{\Delta t} \leq \left. \bar{s}_{sz}  \right.\rvert_{\Delta t}\)</span> this places an additional condition of
<span class="math display">\[\begin{equation}
\hat{r}_{rz \rightarrow uz} \leq \frac{1}{\Delta t} \left(
\left. \bar{s}_{sz} \right.\rvert_{\Delta t} + \frac{\Delta t}{T_d} - \left. \bar{s}_{uz} \right.\rvert_{0}\right)
\end{equation}\]</span></p>
<p>This condition also implies that <span class="math inline">\(\hat{r}_{uz \rightarrow sz} \leq  \frac{1}{T_d}\)</span></p>
</div>
<div id="saturated-zone-1" class="section level2">
<h2 class="hasAnchor">
<a href="#saturated-zone-1" class="anchor"></a>Saturated Zone</h2>
<p>Initial evaluation and substitution of the flux from the unsaturated zone gives
<span class="math display">\[\begin{equation}
\left. \bar{s}_{sz}\right.\rvert_{\Delta t} = 
\left. \bar{s}_{sz}\right.\rvert_{\Delta 0} + 
\frac{\Delta t}{\Delta x} \left(g\left(\left.\bar{s}_{sz}\right\rvert_{\Delta t},\Theta_{sz}\right) -
l_{sz}^{-}\right) - \Delta t \frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \hat{r}_{rz \rightarrow uz} }
{ T_{d}\left. \bar{s}_{sz} \right.\rvert_{\Delta t} + \Delta t}
\end{equation}\]</span></p>
<p>Limiting the inflow by reaching the saturation level gives</p>
<p><span class="math display">\[\begin{equation}
\hat{r}_{rz \rightarrow uz} \leq \frac{1}{\Delta t}\left(
\left. \bar{s}_{sz}\right.\rvert_{\Delta 0} + 
\frac{\Delta t}{\Delta x} \left(g\left(\left.\bar{s}_{sz}\right\rvert_{\Delta t},\Theta_{sz}\right) -
l_{sz}^{-}\right) - \left. \bar{s}_{uz} \right.\rvert_{0} \right)
\end{equation}\]</span></p>
<p>Selecting <span class="math inline">\(\bar{s}_{sz}\)</span> and <span class="math inline">\(\hat{r}_{rz \rightarrow uz}\)</span> to satisfy the above equation describes a non-linear
problem with two unknowns a multiple solutions. A further condition, that the
downward flux is maximised, is imposed to ensure a unique solution.</p>
</div>
</div>
<div id="numerical-algorithm" class="section level1">
<h1 class="hasAnchor">
<a href="#numerical-algorithm" class="anchor"></a>Numerical Algorithm</h1>
<p>An implementation of the approximating equations which is consistent with
maximising the downward flux produces a fully implicit numeric scheme.</p>
<p>The maximum downward flux from the surface is given by
<span class="math display">\[
\check{r}_{sf \rightarrow rz} = \min\left( k_{sf},
\left. \frac{1}{\Delta t}\left(\bar{s}_{sf} \right\rvert_{0} + \frac{\Delta
t}{\Delta x} \hat{l}_{sf}^{-}
\right)\right)
\]</span></p>
<p>which results in a maximum downward flux from the root zone of
<span class="math display">\[
\check{r}_{rz \rightarrow uz} = \max\left(0, \frac{1}{\Delta t}\left(
\left. \bar{s}_{rz} \right.\rvert_{0} + \Delta t \left( p + \check{r}_{sf
\rightarrow rz} - e_{p} \right) - s_{rzmax} \right)\right)
\]</span></p>
<p>Consider the psuedo-function
<span class="math display">\[
f\left(z\right) = 
z - 
\left. \bar{s}_{sz}\right.\rvert_{\Delta 0} -
\frac{\Delta t}{\Delta x} \left(g\left(z,\Theta_{sz}\right) -
l_{sz}^{-}\right) + \Delta t \min\left(\frac{1}{T_d},\frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ T_{d} z + \Delta t}\right)
\]</span></p>
<p>adapted from the approximating equation for the saturated zone storage with the minima
ensuring the limit on the flux from the unsaturated zone. If <span class="math inline">\(f(0) \geq 0\)</span> the
downward flux is enough to produce saturation in the subsurface and
<span class="math inline">\(\left. \bar{s}_{sz}\right.\rvert_{\Delta t} = 0\)</span>. If <span class="math inline">\(f(0) &lt; 0\)</span> then
<span class="math inline">\(\left. \bar{s}_{sz}\right.\rvert_{\Delta t} = 0\)</span> is given by a solution of
<span class="math inline">\(f(z) = 0\)</span>. In Appendix A it is
shown that <span class="math inline">\(f\left(z\right)\)</span> is a monotonic increasing function of
<span class="math inline">\(z &gt; 0\)</span>; hence if <span class="math inline">\(f\left(0\right) \leq 0\)</span> and <span class="math inline">\(f\left(D\right) \geq 0\)</span> a
unique solution for <span class="math inline">\(\left. \bar{s}_{sz}\right.\rvert_{\Delta t}\)</span> can be found.</p>
<!-- ### Algorithm 1 - Simple Implicit -->
<p>A direct implimnetation of the above results takes the form of</p>
<ol style="list-style-type: decimal">
<li>Compute <span class="math inline">\(\check{r}_{sf \rightarrow rz}\)</span> and <span class="math inline">\(\check{r}_{rz \rightarrow uz}\)</span>
</li>
<li>Test for saturation. If <span class="math inline">\(f\left(0\right) \geq 0\)</span> then goto Step 3 else goto Step 4</li>
<li>Saturated. Set <span class="math inline">\(\left. \bar{s}_{sz}\right.\rvert_{\Delta t} = 0\)</span> and
<span class="math display">\[\hat{r}_{rz \rightarrow uz} = \frac{1}{\Delta t}\left(
\left. \bar{s}_{sz}\right.\rvert_{\Delta 0} + 
\frac{\Delta t}{\Delta x} \left(g\left(0,\Theta_{sz}\right) -
l_{sz}^{-}\right) - \left. \bar{s}_{uz} \right.\rvert_{0} \right)
\]</span>
Goto Step 5.</li>
<li>Not saturated. Find <span class="math inline">\(\left. \bar{s}_{sz}\right.\rvert_{\Delta t}\)</span> such that
<span class="math inline">\(f\left(\left. \bar{s}_{sz}\right.\rvert_{\Delta t}\right) = 0\)</span> and take
<span class="math display">\[
\hat{r}_{rz \rightarrow uz} = \min\left(\check{r}_{rz \rightarrow uz},\frac{1}{\Delta t} \left(
\left. \bar{s}_{sz} \right.\rvert_{\Delta t} + \frac{\Delta t}{T_d} -
 \left. \bar{s}_{uz} \right.\rvert_{0}\right)\right)\]</span>
Goto Step 5.</li>
<li>Compute
<span class="math display">\[
\hat{r}_{sf \rightarrow rz} = \min\left(\check{r}_{sf \rightarrow
  rz}, \frac{1}{\Delta t}\left( s_{rzmax} - 
\left. \bar{s}_{rz} \right.\rvert_{0} - \Delta t \left( p - e_p - \hat{r}_{rz
  \rightarrow uz} \right) \right)\right)\]</span>
</li>
<li>Solve for <span class="math inline">\(\left. \bar{s}_{uz}\right.\rvert_{\Delta t}\)</span>,
<span class="math inline">\(\left. \bar{s}_{rz}\right.\rvert_{\Delta t}\)</span> and
<span class="math inline">\(\left. \bar{s}_{sf}\right.\rvert_{\Delta t}\)</span> using the computed vertical
fluxes.</li>
</ol>
<!-- ## Algorithm 2 --><!-- 1. Compute $\check{r}_{sf \rightarrow rz} = \min\left( k_{sf}, --><!-- \left. \bar{s}_{sf} \right\rvert_{0} + \frac{\Delta t \hat{q}_{sf}^{-}}{A} --><!-- \right)$ --><!-- 2. Compute $\check{r}_{rz \rightarrow uz} = \max\left(0, \frac{1}{\Delta t}\left( --><!-- \left. \bar{s}_{rz} \right.\rvert_{0} + \Delta t \left( p + \check{r}_{sf --><!--   \rightarrow rz} - e_{p} \right) - s_{rzmax} \right)\right)$ --><!-- 3. Test for saturation. If $f\left(0,\check{r}_{rz \rightarrow uz}\right) \geq --><!--    0$ then goto 4 else goto 5 --><!-- 4. Saturated. Set $\left. \bar{s}_{sz}\right.\rvert_{\Delta t} = 0$ and --><!-- $\hat{r}_{rz \rightarrow uz} = \frac{1}{\Delta t}\left( --><!-- \left. \bar{s}_{sz}\right.\rvert_{0} + \Delta t \left( --><!-- \frac{w^{+}}{A}g\left(0,\Theta_{sz}\right) - --><!-- \frac{q_{sz}^{-}}{A}\right) - \left. \bar{s}_{uz} \right.\rvert_{0} \right)$, --><!-- Goto 7 --><!-- 5. Not saturated: find $\left. \bar{s}_{sz}\right.\rvert_{\Delta t}$ such that  --><!-- $f\left(\left. \bar{s}_{sz}\right.\rvert_{\Delta t},\check{r}_{rz \rightarrow --><!--   uz}\right) = 0$.  --><!-- 6. Set $\hat{r}_{rz \rightarrow uz} = \min\left(\check{r}_{rz \rightarrow uz},\frac{1}{\Delta t} \left( --><!-- \left. \bar{s}_{sz} \right.\rvert_{\Delta t} + \frac{\Delta t}{T_d} - --><!--  \left. \bar{s}_{uz} \right.\rvert_{0}\right)\right)$. --><!-- 7. Compute $\hat{r}_{sf \rightarrow rz} = \min\left(\check{r}_{sf \rightarrow --><!--   rz}, \frac{1}{\Delta t}\left( s_{rzmax} -  --><!-- \left. \bar{s}_{rz} \right.\rvert_{0} - \Delta t \left( p - e_p - \hat{r}_{rz --><!--   \rightarrow uz} \right) \right)\right)$ --><!-- 8. Solve for $\left. \bar{s}_{uz}\right.\rvert_{\Delta t}$, --><!-- $\left. \bar{s}_{rz}\right.\rvert_{\Delta t}$ and --><!-- $\left. \bar{s}_{sf}\right.\rvert_{\Delta t}$ using the computed vertical --><!-- fluxes. --><!-- The first two steps compute the maximum potential downward flux from the --><!-- surface and root zones. Steps 3-6 solve saturated zoneand adjust the fluz from --><!-- the root zone to the unsaturated zone accordingly. Step 7 adjusts the flux --><!-- from the surface zone in the case of upward flow from the unsaturated zone, --><!-- with Step 8 using the corrected vertical fluxes to solve for the new values of --><!-- the states. -->
</div>
<div id="transmissivity-profiles" class="section level1">
<h1 class="hasAnchor">
<a href="#transmissivity-profiles" class="anchor"></a>Transmissivity Profiles</h1>
<p>The solution and numerical scheme have been presented with a general
transmissivity function <span class="math inline">\(g\left(\bar{s}_{sz},\Theta_{sz}\right)\)</span>. Table
<a href="#tab:hs-transmissivity">2</a> present the transmissivity profiles present as options within the <code>dynatop</code>
package, the corresponding value to use for the <code>transmissivity_profile</code> value
in the model options vector and the additional parameters or properties
required. The additional parameter and properties are defined in Table <a href="#tab:hs-transmissivity-param">3</a>.</p>
<table class="table">
<caption>
<span id="tab:hs-transmissivity">Table 2: </span> Transmissivity profiles avaiable with the
<code>dynatop</code> package.</caption>
<colgroup>
<col width="16%">
<col width="16%">
<col width="16%">
<col width="16%">
<col width="16%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th><span class="math inline">\(g\left(\bar{s}_{sz},\Theta_{sz}\right)\)</span></th>
<th>Celerity</th>
<th><span class="math inline">\(\Theta_{sz}\)</span></th>
<th>
<code>transmissivity_profile</code> value</th>
<th>Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Exponental</td>
<td><span class="math inline">\(T_{0}\sin\left(\beta\right)\exp\left(-\frac{\cos\beta}{m}s_{sz}\right)\)</span></td>
<td><span class="math inline">\(\frac{\cos\beta}{m}g\left(\bar{s}_{sz},\Theta_{sz}\right)\)</span></td>
<td><span class="math inline">\(T_0,\beta,m\)</span></td>
<td><code>"exp"</code></td>
<td>Originally given in <a href="https://doi.org/10.1002/hyp.252">Beven &amp; Freer 2001</a>
</td>
</tr>
<tr class="even">
<td>Bounded Exponential</td>
<td><span class="math inline">\(T_{0}\sin\left(\beta\right)\left(\exp\left(-\frac{\cos\beta}{m}s_{sz}\right) - \exp\left(-\frac{\cos\beta}{m}D\right)\right)\)</span></td>
<td><span class="math inline">\(\frac{cos \beta}{m}T_{0}\sin\left(\beta\right)\exp\left(-\frac{\cos\beta}{m}s_{sz}\right)\)</span></td>
<td><span class="math inline">\(T_0,\beta,m,D\)</span></td>
<td><code>"bexp"</code></td>
<td>Originally given in <a href="https://doi.org/10.1002/hyp.252">Beven &amp; Freer 2001</a>
</td>
</tr>
<tr class="odd">
<td>Constant Celerity</td>
<td><span class="math inline">\(c_{sz}\left(D-s_{sz}\right)\)</span></td>
<td><span class="math inline">\(c_{sz}\)</span></td>
<td><span class="math inline">\(c_{sz},D\)</span></td>
<td><code>"cnst"</code></td>
<td></td>
</tr>
<tr class="even">
<td>Double Exponential</td>
<td><span class="math inline">\(T_{0}\sin\left(\beta\right)\left( \omega\exp\left(-\frac{\cos\beta}{m}s_{sz}\right) + \left(1-\omega\right)\exp\left(\frac{\cos\beta}{m_2}s_{sz}\right)\right)\)</span></td>
<td><span class="math inline">\(\omega\frac{cos \beta}{m}T_{0}\sin\left(\beta\right)\exp\left(-\frac{\cos\beta}{m}s_{sz}\right) + \left(1-\omega \right)\frac{cos \beta}{m_2}T_{0}\sin\left(\beta\right)\exp\left(-\frac{\cos\beta}{m_2}s_{sz}\right)\)</span></td>
<td><span class="math inline">\(T_0,\beta,m,m_2,\omega\)</span></td>
<td>“dexp”</td>
<td></td>
</tr>
</tbody>
</table>
<table class="table">
<caption>
<span id="tab:hs-transmissivity-param">Table 3: </span> Additional paraemters used in the transmissivity profiles.</caption>
<thead><tr class="header">
<th>Symbol</th>
<th>Description</th>
<th>unit</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(T_0\)</span></td>
<td>Transmissiviy at saturation</td>
<td>m<span class="math inline">\(^2\)</span>/s</td>
</tr>
<tr class="even">
<td>
<span class="math inline">\(m\)</span>,<span class="math inline">\(m_2\)</span>
</td>
<td>Exponential transmissivity constants</td>
<td>m<span class="math inline">\(^{-1}\)</span>
</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\beta\)</span></td>
<td>Angle of hill slope</td>
<td>rad</td>
</tr>
<tr class="even">
<td><span class="math inline">\(c_{sz}\)</span></td>
<td>Saturated zone celerity</td>
<td>m/s</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(D\)</span></td>
<td>Depth at which zero lateral flow occurs</td>
<td>m</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\omega\)</span></td>
<td>weighting parameter</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
<div id="appendix-a---monoticity-of-fleftzright" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix-a---monoticity-of-fleftzright" class="anchor"></a>Appendix A - Monoticity of <span class="math inline">\(f\left(z\right)\)</span>
</h1>
<p>By definition <span class="math inline">\(\left. \bar{s}_{uz} \right.\rvert_{0}\)</span>, <span class="math inline">\(\Delta t\)</span>, <span class="math inline">\(\Delta X\)</span>,
<span class="math inline">\(T_d\)</span>, <span class="math inline">\(\check{r}_{rz \rightarrow uz}\)</span> and <span class="math inline">\(z\)</span> are all greater or equal to 0. Rewrite the expression for <span class="math inline">\(f\left(z\right)\)</span> as
<span class="math display">\[
f\left(z\right) = \left\{ \begin{array}{cl}
z - 
\left. \bar{s}_{sz}\right.\rvert_{\Delta 0} -
\frac{\Delta t}{\Delta x} \left(g\left(z,\Theta_{sz}\right) -
l_{sz}^{-}\right) + \frac{\Delta t}{T_d} &amp; 
\frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ T_{d} z + \Delta t} \geq \frac{1}{T_d} \\
z - 
\left. \bar{s}_{sz}\right.\rvert_{\Delta 0} -
\frac{\Delta t}{\Delta x} \left(g\left(z,\Theta_{sz}\right) -
l_{sz}^{-}\right) + \Delta t \frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ T_{d} z + \Delta t} &amp; 
\frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ T_{d} z + \Delta t} &lt; \frac{1}{T_d}
\end{array}\right.
\]</span></p>
<p>Differentiating with respect to <span class="math inline">\(z\)</span> gives
<span class="math display">\[
\frac{d}{dz} f\left(z\right) = \left\{ \begin{array}{cl}
1 - 
\frac{\Delta t}{\Delta x} \frac{d}{dz}g\left(z,\Theta_{sz}\right) &amp; 
\frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ T_{d} z + \Delta t} \geq \frac{1}{T_d} \\
1 - 
\frac{\Delta t}{\Delta x} \frac{d}{dz}g\left(z,\Theta_{sz}\right)
- T_d \Delta t \frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ \left(T_{d} z + \Delta t\right)^2} &amp; 
\frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ T_{d} z + \Delta t} &lt; \frac{1}{T_d}
\end{array}\right.
\]</span></p>
<p>The definition of the function <span class="math inline">\(g\)</span> states that
<span class="math display">\[
-\frac{d}{dz}g\left(z,\Theta_{sz}\right) \geq 0
\]</span>
Using this relationship and the expression for the range of <span class="math inline">\(z\)</span> gives
<span class="math display">\[
\frac{d}{dz} f\left(z\right) \geq \left\{ \begin{array}{cl}
1 &amp; 
\frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ T_{d} z + \Delta t} \geq \frac{1}{T_d} \\
1 - \frac{\Delta t}{T_{d} z + \Delta t} &amp; 
\frac{
\left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} }
{ T_{d} z + \Delta t} &lt; \frac{1}{T_d}
\end{array}\right.
\]</span></p>
<p>From this it can be seen that <span class="math inline">\(\frac{d}{dz} f\left(z\right) \geq 0\)</span> with
equality possible when <span class="math inline">\(z=0\)</span>.</p>
<!-- ### Solution of $f\left(z\right)$ for known $l_{sz}^{+}$ -->
<!-- By definition $\left. \bar{s}_{uz} \right.\rvert_{0}$, $l_{sz}^{+}$, -->
<!-- $l_{sz}^{-}$, $\Delta t$, $\Delta X$, -->
<!-- $T_d$, $\check{r}_{rz -->
<!-- \rightarrow uz}$ and $z$ are all greater or equal to 0. Rewrite the expression -->
<!-- for $f\left(z\right)$ with known $l_{sz}^{+}$ as -->
<!-- \[ -->
<!-- \tilde{f}\left(z\right) = \left\{ \begin{array}{cl} -->
<!-- z -  -->
<!-- \left. \bar{s}_{sz}\right.\rvert_{\Delta 0} - -->
<!-- \frac{\Delta t}{\Delta x} \left(l_{sz}^{+} - -->
<!-- l_{sz}^{-}\right) + \frac{\Delta t}{T_d} &  -->
<!-- \frac{ -->
<!-- \left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} } -->
<!-- { T_{d} z + \Delta t} \geq \frac{1}{T_d} \\ -->
<!-- z -  -->
<!-- \left. \bar{s}_{sz}\right.\rvert_{\Delta 0} - -->
<!-- \frac{\Delta t}{\Delta x} \left(l_{sz}^{+} - -->
<!-- l_{sz}^{-}\right) + \Delta t \frac{ -->
<!-- \left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} } -->
<!-- { T_{d} z + \Delta t} &  -->
<!-- \frac{ -->
<!-- \left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} } -->
<!-- { T_{d} z + \Delta t} < \frac{1}{T_d} -->
<!-- \end{array}\right. -->
<!-- \] -->
<!-- Taking $z_{C} = \left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t -->
<!-- \check{r}_{rz \rightarrow uz} - \frac{\Delta t}{T_d}$ gives -->
<!-- \[ -->
<!-- \tilde{f}\left(z\right) = \left\{ \begin{array}{cl} -->
<!-- z -  -->
<!-- \left. \bar{s}_{sz}\right.\rvert_{\Delta 0} - -->
<!-- \frac{\Delta t}{\Delta x} \left(l_{sz}^{+} - -->
<!-- l_{sz}^{-}\right) + \frac{\Delta t}{T_d}  -->
<!-- & z_{C} \geq z \\ -->
<!-- z -  -->
<!-- \left. \bar{s}_{sz}\right.\rvert_{\Delta 0} - -->
<!-- \frac{\Delta t}{\Delta x} \left(l_{sz}^{+} - -->
<!-- l_{sz}^{-}\right) + \Delta t \frac{ -->
<!-- \left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} } -->
<!-- { T_{d} z + \Delta t}  -->
<!-- & z_{C} < z  -->
<!-- \end{array} \right. -->
<!-- \] -->
<!-- The monotonic properties of $\tilde{f}\left(z\right)$ are identical to those -->
<!-- of $f\left(z\right)$. Consider the case that $\tilde{f}\left(z\right) < 0$, -->
<!-- hence $\left. s_{sz} \right.\rvert_{\Delta t} > 0$. If $z_{C} > 0$ and -->
<!-- $\tilde{f}\left(z_{C}\right) \geq 0$ then $0< \left. s_{sz} \right.\rvert_{\Delta -->
<!-- t} \leq z_{C}$ and is given by -->
<!-- \[ -->
<!-- \left. s_{sz} \right.\rvert_{\Delta t} =  -->
<!-- \left. \bar{s}_{sz}\right.\rvert_{\Delta 0} + -->
<!-- \frac{\Delta t}{\Delta x} \left(l_{sz}^{+} - -->
<!-- l_{sz}^{-}\right) - \frac{\Delta t}{T_d}  -->
<!-- \] -->
<!-- Alternatively either $z_{C} \leq 0$ or $\tilde{f}\left(z_{C}\right) < 0$ for a -->
<!-- $z_{C} > 0$. The solution for $\left. s_{sz} \right.\rvert_{\Delta -->
<!-- t}$ in then a value of $z$ for which -->
<!-- \[ -->
<!-- z -  -->
<!-- \left. \bar{s}_{sz}\right.\rvert_{\Delta 0} - -->
<!-- \frac{\Delta t}{\Delta x} \left(l_{sz}^{+} - -->
<!-- l_{sz}^{-}\right) + \Delta t \frac{ -->
<!-- \left. \bar{s}_{uz} \right.\rvert_{0} + \Delta t \check{r}_{rz \rightarrow uz} } -->
<!-- { T_{d} z + \Delta t} =0 -->
<!-- \] -->
<!-- \[ -->
<!-- z - \mu + \frac{\pi}{T_{d} z + \Delta t} =0 \\ -->
<!-- T_{d} z^2 + z\Delta t - \mu T_{d}z - \mu \Delta t + \pi = 0\\ -->
<!-- T_{d} z^2 + \left(\Delta t - \mu T_{d}\right)z + \pi - \mu \Delta t = 0 -->
<!-- \] -->
</div>
<div id="appendix-b---comparision-to-the-infantesimal-slab-derivation" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix-b---comparision-to-the-infantesimal-slab-derivation" class="anchor"></a>Appendix B - Comparision to the Infantesimal slab derivation</h1>
<div id="surface-zone-1" class="section level2">
<h2 class="hasAnchor">
<a href="#surface-zone-1" class="anchor"></a>Surface Zone</h2>
<p>A similar expression for the evolution can be derived by considering the
infinitesimal slab at the downslope end of the HRU. Taking a discrete
approximation for the change of flow with length the governing ODE can be written as
<span class="math display">\[\begin{equation}
\frac{dw^{+}s_{sf}^{+}}{dt} = \frac{q_{sf}^{-} - q_{sf}^{+}}{\Delta x} - w^{+}r_{sf \rightarrow rz}^{+}
\end{equation}\]</span></p>
<p>Dividing through by <span class="math inline">\(w^{+}\)</span> gives
<span class="math display">\[\begin{equation}
\frac{ds_{sf}^{+}}{dt} = \frac{q_{sf}^{-}/w^{+} - l_{sf}^{+}}{\Delta x} - r_{sf \rightarrow rz}^{+}
\end{equation}\]</span></p>
<p>Note the similaties between this and the finite volume solution. Infact if
<span class="math inline">\(r_{sf \rightarrow rz}\)</span> is taken to be spatially uniform and
<span class="math inline">\(\Delta x = A/w^{+}\)</span> then this solution for <span class="math inline">\(s_{sf}^{+}\)</span> will evolve in a similar fashion to
<span class="math inline">\(\bar{s}_{sf}\)</span></p>
</div>
<div id="root-zone-2" class="section level2">
<h2 class="hasAnchor">
<a href="#root-zone-2" class="anchor"></a>Root Zone</h2>
<p>The same formulation follows for the infinitesimal slab at the bottom of the
hillslope with the averaged terms (using <span class="math inline">\(\bar{}\)</span>) replaced with those valid
at the bottom of the hillslope (using <span class="math inline">\(^{+}\)</span>).</p>
</div>
<div id="unsaturated-zone-2" class="section level2">
<h2 class="hasAnchor">
<a href="#unsaturated-zone-2" class="anchor"></a>Unsaturated Zone</h2>
<p>The same formulation follows for the infinitesimal slab at the bottom of the
hillslope with the averaged terms (using <span class="math inline">\(\bar{}\)</span>) replaced with those valid
at the bottom of the hillsipe (using <span class="math inline">\(^{+}\)</span>).</p>
</div>
<div id="saturated-zone-2" class="section level2">
<h2 class="hasAnchor">
<a href="#saturated-zone-2" class="anchor"></a>Saturated Zone</h2>
<p>Evaluating for the foot of the hillslope and taking a discrete approximation
of the spatial gradient gives
<span class="math display">\[\begin{equation}
\frac{ds_{sz}^{+}}{dt} = \frac{l_{sz}^{+} - q_{sz}^{-}/w^{+}}{\Delta x} - r_{uz \rightarrow sz}^{+}
\end{equation}\]</span></p>
<p>As with the surface zone we see the similarity in form, indicating that,
subject to the evaluation of the temporal integral, the two formulations
should return the same results when <span class="math inline">\(\Delta x = A/w^{+}\)</span></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul Smith, Peter Metcalfe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
