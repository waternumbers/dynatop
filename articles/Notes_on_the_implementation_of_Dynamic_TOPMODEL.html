<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notes on the implementation of Dynamic TOPMODEL • dynatop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Notes on the implementation of Dynamic TOPMODEL">
<meta property="og:description" content="dynatop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/dynatop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Channel_HRU.html">Channel HRU</a>
    </li>
    <li>
      <a href="../articles/Hillslope_HRU.html">The Hillslope HRU</a>
    </li>
    <li>
      <a href="../articles/Notes_on_the_implementation_of_Dynamic_TOPMODEL.html">Notes on the implementation of Dynamic TOPMODEL</a>
    </li>
    <li>
      <a href="../articles/Selected_References.html">Selected References</a>
    </li>
    <li>
      <a href="../articles/The_Model_Object.html">The Model Object</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waternumbers/dynatop/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Notes on the implementation of Dynamic TOPMODEL</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waternumbers/dynatop/blob/HEAD/vignettes/Notes_on_the_implementation_of_Dynamic_TOPMODEL.Rmd" class="external-link"><code>vignettes/Notes_on_the_implementation_of_Dynamic_TOPMODEL.Rmd</code></a></small>
      <div class="hidden name"><code>Notes_on_the_implementation_of_Dynamic_TOPMODEL.Rmd</code></div>

    </div>

    
    
<p>The <code>dynatop</code> package represents an implementation of the concepts behind a dynamic TOPMODEL.
One of the underlying principles of dynamic TOPMODEL is that the landscape can be broken up into
hydrologically similar regions, or Hydrological Response Units (HRUs), where
all the area within a HRU behaves in a hydrologically similar fashion.</p>
<p>While a Hydrological Response Unit (HRU) has typically been thought of as an
area of hill slope with, for example, similar topographic, soil and upslope area
characteristics the idea may be generalised. In doing this a catchments is
conceptualised as a collection of HRUs of different type (e.g. hill slope,
channel, lake) which exchange fluxes at specified levels (e.g. saturated zone,
surface)</p>
<p>As well as the exchange of fluxes this documents considers two types of HRU. The first termed
“hillslope” solves the surface, root, unsaturated and saturated zones
for ‘similar’ areas of hill slope the catchment a each time step.
The second termed “channel” represents a length of river channel in a
simplified manner allowing the extraction of the inflow from the
hill slope. The solutions for each of these HRU types are presented in the
<a href="Hillslope_HRU.html">hillslope</a> and <a href="Channel_HRU.html">channel</a> vignettes.</p>
<p>The aim of this document is to outline</p>
<ul>
<li>the computational sequence and linking the HRUs</li>
<li>conventions for the input data</li>
<li>other miscellaneous information that may help developers</li>
</ul>
<div class="section level2">
<h2 id="the-solution-order-of-hrus-and-exchange-of-fluxes">The solution order of HRUs and exchange of fluxes<a class="anchor" aria-label="anchor" href="#the-solution-order-of-hrus-and-exchange-of-fluxes"></a>
</h2>
<p>Each HRU has a unique reference number in the <code>id</code> variable. In principle the HRUs are
solved in reverse order of <code>id</code>; that is from the largest <code>id</code> value to the
smallest. Currently this not strictly enforced since the C++ code used for the
computation first solves the hillslope HRUs then the channel HRUs, but this
should not be relied upon and may change in future releases.</p>
<p>Fluxes between the HRUs are represented as occurring at two levels, the surface and the
saturated zones. For the <span class="math inline">\(i\)</span>th HRU the outflow in <span class="math inline">\(m^3/s\)</span> at time <span class="math inline">\(t+\Delta t\)</span> is
<span class="math inline">\(\left.q_{sf}^{\left[i\right]}\right\rvert_{t+\Delta t}\)</span> at the surface and
<span class="math inline">\(\left.q_{sz}^{\left[i\right]}\right\rvert_{t+\Delta t}\)</span> in the saturated
zone.</p>
<p>The fraction of outflow going from the <span class="math inline">\(i\)</span> th to the <span class="math inline">\(j\)</span> th HRU is <span class="math inline">\(f_{i,j}\)</span>.
The redistribution is conservative as does not vary in time so
<span class="math display">\[
\sum\limits_{j} f_{i,j} = 1
\]</span>
Since there is no exchange between the surface and saturated zones during
redistribution the inflows at time <span class="math inline">\(t+\Delta t\)</span> to the <span class="math inline">\(k\)</span>th HRU can be computed as
<span class="math display">\[
\sum\limits_{i&gt;k} f_{i,k}\left.q_{sf}^{\left[i\right]}\right\rvert_{t+\Delta t}
\]</span>
and
<span class="math display">\[
\sum\limits_{i&gt;k} f_{i,k}\left.q_{sz}^{\left[i\right]}\right\rvert_{t+\Delta t}
\]</span></p>
<p>The values of <span class="math inline">\(f_{i,j}\)</span> are specified in the <code>flow_direction</code> data.frame of
the model.</p>
</div>
<div class="section level2">
<h2 id="input-series">Input Series<a class="anchor" aria-label="anchor" href="#input-series"></a>
</h2>
<p>It is expected that the precipitation and potential evapotranspiration inputs series are
given in <span class="math inline">\(m\)</span> accrued over the proceeding time step. So if the data has a time
step <span class="math inline">\(\Delta t\)</span> the value given at <span class="math inline">\(t+\Delta t\)</span> is accrued in the interval between time <span class="math inline">\(t\)</span>
and time <span class="math inline">\(t+\Delta t\)</span>.</p>
<p>The data series for the diffuse and point inputs used in the channel routing
should be in <span class="math inline">\(m^3/s\)</span>. In the channel HRU solution the value given at time
<span class="math inline">\(t+\Delta t\)</span> is presumed to be constant over the interval <span class="math inline">\(t\)</span> to <span class="math inline">\(t+\Delta t\)</span>.</p>
</div>
<div class="section level2">
<h2 id="miscellaneous-coding-comments">Miscellaneous Coding comments<a class="anchor" aria-label="anchor" href="#miscellaneous-coding-comments"></a>
</h2>
<div class="section level3">
<h3 id="relating-the-vignette-notation-and-code-variables">Relating the vignette notation and code variables<a class="anchor" aria-label="anchor" href="#relating-the-vignette-notation-and-code-variables"></a>
</h3>
<p>To aid the readability of the code the variables are labelled consistently
with regards to the vignettes. For example:</p>
<ul>
<li>Single subscript: <span class="math inline">\(l_{sz}\)</span> becomes <code>l_sz</code>, <span class="math inline">\(s_{uz}\)</span> becomes <code>s_uz</code> etc.</li>
<li>Directional variables: <span class="math inline">\(q_{rz \rightarrow uz}\)</span> becomes <code>q_rz_uz</code>, etc.</li>
<li>Greek letters are spelt: <span class="math inline">\(\lambda\)</span> becomes <code>lambda</code>
</li>
</ul>
<p>However the notation used in the vignettes for intermediate values of fluxes
or states (e.g. ) is dropped from the code where it can be inferred from
the computational sequence (or comments)</p>
</div>
<div class="section level3">
<h3 id="numerical-solutions">Numerical solutions<a class="anchor" aria-label="anchor" href="#numerical-solutions"></a>
</h3>
<p>Currently the code uses a purely implicit scheme for the solution of the
hillslope HRUs. This requires a solving a <em>zero finding</em> problem for each HRU
at each (sub)time step. Currently a simple bisection algorithm is used with a
user specified tolerance and maximum number of iterations. The tolerance is
defined as the difference between the upper and lower limits of the interval
containing the zero point. Notionally faster algorithms (such as the TOMS-748
algorithm) could be used.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul Smith, Peter Metcalfe.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
