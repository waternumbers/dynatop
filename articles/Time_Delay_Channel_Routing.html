<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time Delay Channel Routing â€¢ dynatop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Time Delay Channel Routing">
<meta property="og:description" content="dynatop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynatop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dynatop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Notes_on_the_implimentation.html">Notes on the Implimentation</a>
    </li>
    <li>
      <a href="../articles/Selected_References.html">Selected References</a>
    </li>
    <li>
      <a href="../articles/The_Model_Object.html">The Model Object</a>
    </li>
    <li>
      <a href="../articles/The_solution_of_Dynamic_TOPMODEL.html">The Dynamic TOPMODEL equations</a>
    </li>
    <li>
      <a href="../articles/Time_Delay_Channel_Routing.html">Time Delay Channel Routing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/waternumbers/dynatop/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Time Delay Channel Routing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/waternumbers/dynatop/blob/master/vignettes/Time_Delay_Channel_Routing.Rmd"><code>vignettes/Time_Delay_Channel_Routing.Rmd</code></a></small>
      <div class="hidden name"><code>Time_Delay_Channel_Routing.Rmd</code></div>

    </div>

    
    
<p>The <code>dynatop</code> function in the dynamic TOPMODEL R package implements a set of numerical solutions to the governing equations of the dynamic TOPMODEL hillslope formulation. This returns the inflow to the channel reachs specified in the model. This vignette documents the formulation and the numerical solution used to route these channel inflows, along with other diffuse and point inputs to the model.</p>
<div id="notation-and-nomenclature" class="section level1">
<h1 class="hasAnchor">
<a href="#notation-and-nomenclature" class="anchor"></a>Notation and nomenclature</h1>
<p>Table [tab:hru_notation] outlines the notation used in this document.</p>
<table class="table">
<caption>Outline of notation for describing time delay histogram routing HRUs<span data-label="tab:channel_notation"></span>
</caption>
<thead><tr class="header">
<th align="left">Quantity type</th>
<th align="center">Symbol</th>
<th align="center">Description</th>
<th align="center">unit</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Dischage at the point <span class="math inline">\(x\)</span> at time <span class="math inline">\(t\)</span>
</td>
<td align="center"><span class="math inline">\(q\left(x,t\right)\)</span></td>
<td align="center">Instananeous discharge at the point x on the channel network</td>
<td align="center">-</td>
</tr>
<tr class="even">
<td align="left">A gauged location</td>
<td align="center"><span class="math inline">\(g\)</span></td>
<td align="center">A gagued point on the channel network</td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td align="left">Channel inflow</td>
<td align="center"><span class="math inline">\(h\left(x,t\right)\)</span></td>
<td align="center">Inflow from the hillslope to a point on the channel network</td>
<td align="center">m<span class="math inline">\(^3\)</span>/s</td>
</tr>
<tr class="even">
<td align="left">Diffuse inflow</td>
<td align="center"><span class="math inline">\(d\left(x,t\right)\)</span></td>
<td align="center">Inflow from diffuse inputs to a point on the channel network</td>
<td align="center">m<span class="math inline">\(^3\)</span>/s</td>
</tr>
<tr class="odd">
<td align="left">Diffuse inflow</td>
<td align="center"><span class="math inline">\(p\left(x,t\right)\)</span></td>
<td align="center">Inflow from a point source to a point on the channel network</td>
<td align="center">m<span class="math inline">\(^3\)</span>/s</td>
</tr>
<tr class="even">
<td align="left">Velocity</td>
<td align="center"><span class="math inline">\(v_{ch}\left(x\right)\)</span></td>
<td align="center">Effective velocity of water convience at a point ont eh channel network</td>
<td align="center">m/s</td>
</tr>
</tbody>
</table>
</div>
<div id="time-delay-channel-routing" class="section level1">
<h1 class="hasAnchor">
<a href="#time-delay-channel-routing" class="anchor"></a>Time Delay Channel Routing</h1>
<p>Using a time delay routing approach the discharge at the gauge <span class="math inline">\(g\)</span> at time <span class="math inline">\(t\)</span> can be computed from the inflows of the upstream points on the channel newtork <span class="math inline">\(x \in \mathcal{X}\)</span> and the time it takes the effect of the inflow to been seen at the gauge <span class="math inline">\(\delta_{x\rightarrow g}\)</span> as <span class="math display">\[
q\left(g,t\right) = \int_{x\in\mathcal{X}} h\left(x,t-\delta_{x\rightarrow g}\right) dx
\]</span></p>
<p>The conceptualisation of Dynamic Topmodel breaks the channel network down into <span class="math inline">\(n\)</span> disjoint channel HRUs whose inflows contribute to the discharge at the gauge giving <span class="math display">\[
q\left(g,t\right) = \sum\limits_{i=1}^{n} \int_{x\in\mathcal{X}_{i}}
h\left(x,t-\delta_{x\rightarrow g}\right) dx 
\]</span></p>
</div>
<div id="numerical-solution" class="section level1">
<h1 class="hasAnchor">
<a href="#numerical-solution" class="anchor"></a>Numerical Solution</h1>
<p>Consider the contribution to the gauges flow from a single channel HRU <span class="math display">\[
\int_{x\in\mathcal{X}_{i}}
h\left(x,t-\delta_{x\rightarrow g}\right) dx d\tau
\]</span></p>
<p>To further derive the numerical solution a number of assumpptions are made. The first assumption is that the channel represents a single reach of river such the a spatial location <span class="math inline">\(x \in \mathcal{X}_{i}\)</span> can be replaced by a unique length <span class="math inline">\(l\)</span> from the head of the reach. The maximum value of <span class="math inline">\(l\)</span>, denoted<span class="math inline">\(\tilde{L}\)</span>, is the lower of the length of the reach <span class="math inline">\(L\)</span> or the distance to the gauge from the head of the reach. The contribution of the channel HRU to the gauged flow can be expressed as <span class="math display">\[
\int_{0}^{\tilde{L}}
h\left(l,t-\delta_{l\rightarrow g}\right) dl
\]</span></p>
<p>The second assumption is that there is a constant effecive velocity <span class="math inline">\(v\)</span> within the reach. The time delay <span class="math inline">\(\delta_{l\rightarrow g}\)</span> can then be written in terms of the time delay for the head of the reach <span class="math inline">\(\delta_{0\rightarrow g}\)</span> as <span class="math display">\[
\delta_{l\rightarrow g} = \delta_{0\rightarrow g} - lv^{-1}
\]</span> The contribution of the channel HRU to the discharge at the gauge then becomes <span class="math display">\[
\int_{0}^{\tilde{L}}
h\left(l,t-\delta_{0\rightarrow g}+lv^{-1}\right) dl
\]</span></p>
<p>Since the model is solved in discrete time the interal can be divided up into time steps. Let <span class="math inline">\(d_{min}\)</span> be the largest and <span class="math inline">\(d_{max}\)</span> the smallest integers such that <span class="math inline">\(d_{min} &lt; d_{max}\)</span> and <span class="math display">\[
d_{min}\Delta t &lt; \delta_{0\rightarrow g}-\tilde{L}v^{-1} &lt;
\delta_{0\rightarrow g} &lt; d_{max}\Delta t
\]</span> Then taking <span class="math inline">\(\Delta l = v\Delta t\)</span> we can divide the integral up to give <span class="math display">\[
\sum\limits_{j=d_{min}}^{d_{max}-1} \int_{0}^{\Delta l}
h\left(l,t-j\Delta lv^{-1}-\lambda v^{-1}\right) d\lambda
- \int_{0}^{\delta_{0\rightarrow g}-\tilde{L}v^{-1} - d_{min}\Delta lv^{-1}}
h\left(l,t-d_{min}\Delta lv^{-1}-\lambda v^{-1}\right) d\lambda
- \int_{\delta_{0\rightarrow g} - \left(d_{max}-1\right)\Delta
  lv^{-1}}^{\Delta l} h\left(l,t-\left(d_{max}-1\right)\Delta lv^{-1}-\lambda v^{-1}\right) d\lambda
\]</span></p>
<p>The second assumption is that there is no spatial pattern in the inflow to the reach and constant inflow over time steps so that we can write <span class="math display">\[
h\left(l,t-\tau\right) = \bar{h}_{t} \quad \forall
l\in\left(0,L\right),\tau\in\left(0,\Delta t\right)
\]</span> an express the contribution to the gauged flow as <span class="math display">\[
\sum\limits_{j=d_{min}}^{d_{max}-1} \Delta l \bar{h}_{t-j\Delta lv^{-1}}
- \left(\delta_{0\rightarrow g}v - d_{min}\Delta l - \tilde{L}\right)
\bar{h}_{t-d_{min}\Delta l v^{-1}}
- \left( d_{max}\Delta l - \delta_{0\rightarrow g}v \right) \bar{h}_{t-\left(d_{max}-1\right)\Delta lv^{-1}}
\]</span></p>
<p>This can now be expressed in terms of a polynomial of the the backward shift operator <span class="math inline">\(z^{-1}\)</span> as <span class="math inline">\(B\left(z^{-1}\right) \bar{h}_{t-d_{min}\Delta t}\)</span> where</p>
<ul>
<li>for <span class="math inline">\(d_{max}=d_{min}+1\)</span> <span class="math display">\[
B\left(z^{-1}\right) = \left(\Delta l - \left(\delta_{0\rightarrow g}v -
d_{min}\Delta l - \tilde{L}\right) - \left(d_{max}\Delta l -
\delta_{0\rightarrow g}v\right)\right)  = \tilde{L}
\]</span>
</li>
<li>for <span class="math inline">\(d_{max}=d_{min}+2\)</span> <span class="math display">\[
B\left(z^{-1}\right) = \left(\Delta l - \left(\delta_{0\rightarrow g}v -
d_{min}\Delta l - \tilde{L}\right)\right) + \left(\Delta l - \left(d_{max}\Delta l - \delta_{0\rightarrow g}v\right)\right) z^{-1}
\]</span>
</li>
<li>for <span class="math inline">\(d_{max}&gt;d_{min}+2\)</span> <span class="math display">\[
B\left(z^{-1}\right) = \left(\Delta l - \left(\delta_{0\rightarrow g}v -
d_{min}\Delta l - \tilde{L}\right)\right) + \Delta l z^{-1} + \ldots + \Delta l
z^{-(d_{max}-d_{min}-2)} + \left(\Delta l - \left(d_{max}\Delta l - \delta_{0\rightarrow g}v\right)\right) z^{-(d_{max}-d_{min}-1)}
\]</span>
</li>
</ul>
<p>This shows that the instanaeous flow at the outlet can be approximated from the <span class="math inline">\(\bar{h}_{t-d_{min}\Delta t}\)</span> by a linear operation. It remains to be shown that <span class="math inline">\(\bar{h}_{t-d_{min}\Delta t}\)</span> can be related to the output of the <code>dynatop</code> function which is <span class="math display">\[
\frac{1}{\Delta t}
\int_{0}^{\Delta t}\int_{x\in\mathcal{X}_{i}}
h\left(x,t-\tau \right) dx d\tau
\]</span> Under the channel routing assumptions <span class="math display">\[
\frac{1}{\Delta t}
\int_{0}^{\Delta t}\int_{x\in\mathcal{X}_{i}}
h\left(x,t-\tau \right) dx d\tau =
\frac{1}{\Delta t}
\int_{0}^{\Delta t}\int_{0}^{L}
h\left(l,t-\tau \right) dl d\tau =
L \bar{h}_{t}
\]</span></p>
<p>The contribution to the discharge at the channel outlet is therefore a linear filtering of the output of <code>dynatop</code>. From summing the coeffiecnts of <span class="math inline">\(B\left(z^{-1}\right)\)</span> the fraction of the <code>dynatop</code> output returned as discharge at the gauge is <span class="math inline">\(\tilde{L}/L\)</span>. This implies mass conservation the inputs of channel HRUs above the gauge, while if the gauge is sited within the HRU mass is proportional to the fraction fo the reach above it.</p>
</div>
<div id="diffuse-and-point-inputs" class="section level1">
<h1 class="hasAnchor">
<a href="#diffuse-and-point-inputs" class="anchor"></a>Diffuse and Point inputs</h1>
<p>Diffuse input are considered as external inputs that occur over the whole channel HRU while point inputs occur at a given location on the channel network.</p>
<div id="diffuse-inputs" class="section level2">
<h2 class="hasAnchor">
<a href="#diffuse-inputs" class="anchor"></a>Diffuse inputs</h2>
<p>Diffuse inputs are handled in exactly the same way as hillslope inputs. In this case the each value in the input time series is expected to be the total volume of input over the time step (m<span class="math inline">\(^3\)</span>) dived by length of the time step (<span class="math inline">\(s\)</span>) to give an effective time averaged flow (m<span class="math inline">\(^3\)</span>/s) to the HRU, that is: <span class="math display">\[
\frac{1}{\Delta t}
\int_{0}^{\Delta t}\int_{x\in\mathcal{X}_{i}}
d\left(x,t-\tau \right) dx d\tau
\]</span></p>
</div>
<div id="point-inputs" class="section level2">
<h2 class="hasAnchor">
<a href="#point-inputs" class="anchor"></a>Point inputs</h2>
<p>Since the contributions to the simualted discharge at the gauge can be computed individually and summed it is possible to think of a point input as notional channel with infinitesimally small length. This results <span class="math inline">\(d_{max}=d_{min}+1\)</span> and a ratio <span class="math inline">\(\tilde{L}/L=1\)</span>.</p>
<p>In this case that each value in the input time series is inflow averaged over the preceeding time step, that is <span class="math display">\[
\bar{p}_{t} = 
\frac{1}{\Delta t}
\int_{0}^{\Delta t} p\left(x,t-\tau \right) d\tau
\]</span> The assumptions used for hillslope routing above lead to contribution to the outflow being <span class="math inline">\(\bar{p}_{t-d_{min}\Delta t}\)</span>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul Smith, Peter Metcalfe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
